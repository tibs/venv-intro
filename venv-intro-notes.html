<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>An introduction to Python virtual environments</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="an-introduction-to-python-virtual-environments">
<h1 class="title">An introduction to Python virtual environments</h1>

<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#why-do-we-need-virtual-environments" id="id11">Why do we need virtual environments</a><ul>
<li><a class="reference internal" href="#shouldn-t-alter-the-system-python" id="id12">Shouldn't alter the system Python</a></li>
<li><a class="reference internal" href="#can-t-alter-the-available-python" id="id13">Can't alter the available Python</a></li>
<li><a class="reference internal" href="#you-want-to-work-on-two-programs-that-have-conflicting-dependencies" id="id14">You want to work on two programs that have conflicting dependencies</a></li>
<li><a class="reference internal" href="#managing-dependencies" id="id15">Managing dependencies</a></li>
<li><a class="reference internal" href="#but-also-tidiness" id="id16">But also, tidiness</a></li>
<li><a class="reference internal" href="#license-management" id="id17">License management</a></li>
<li><a class="reference internal" href="#what-about-upgrading-python" id="id18">What about upgrading Python?</a></li>
<li><a class="reference internal" href="#actual-use-cases" id="id19">Actual use cases</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-examples" id="id20">The Examples</a></li>
<li><a class="reference internal" href="#python3-m-venv" id="id21"><tt class="docutils literal">python3 <span class="pre">-m</span> venv</tt></a><ul>
<li><a class="reference internal" href="#make-a-working-directory" id="id22">Make a working directory</a></li>
<li><a class="reference internal" href="#check-what-python-s-we-have-available" id="id23">Check what Python(s) we have available</a></li>
<li><a class="reference internal" href="#create-a-virtual-environment" id="id24">Create a virtual environment</a></li>
<li><a class="reference internal" href="#activate-the-virtual-environment" id="id25">Activate the virtual environment</a></li>
<li><a class="reference internal" href="#working-in-a-virtual-environment" id="id26">Working in a virtual environment</a></li>
<li><a class="reference internal" href="#deactivating-a-virtual-environment" id="id27">Deactivating a virtual environment</a></li>
<li><a class="reference internal" href="#using-our-virtual-environment" id="id28">Using our virtual environment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-it-works" id="id29">How it works</a></li>
<li><a class="reference internal" href="#finding-out-what-is-installed" id="id30">Finding out what is installed</a><ul>
<li><a class="reference internal" href="#pip-freeze" id="id31"><tt class="docutils literal">pip freeze</tt></a></li>
<li><a class="reference internal" href="#pipdeptree" id="id32"><tt class="docutils literal">pipdeptree</tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#where-to-put-the-venv-directory" id="id33">Where to put the venv directory</a><ul>
<li><a class="reference internal" href="#project-one-venv-per-directory-tree" id="id34">&quot;project&quot; - one venv per directory tree</a></li>
<li><a class="reference internal" href="#environment-one-venv-per-purpose" id="id35">&quot;environment&quot; - one venv per purpose</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python3-m-venv-help" id="id36"><tt class="docutils literal">python3 <span class="pre">-m</span> venv help</tt></a></li>
<li><a class="reference internal" href="#wrappers-to-make-it-easier" id="id37">Wrappers to make it easier</a><ul>
<li><a class="reference internal" href="#virtualenv" id="id38">virtualenv</a></li>
<li><a class="reference internal" href="#virtualenvwrapper" id="id39">virtualenvwrapper</a></li>
<li><a class="reference internal" href="#pipenv" id="id40">pipenv</a></li>
<li><a class="reference internal" href="#poetry" id="id41">poetry</a></li>
<li><a class="reference internal" href="#conda" id="id42">conda</a></li>
<li><a class="reference internal" href="#enthought-deployment-manager" id="id43">Enthought Deployment Manager</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ides" id="id44">IDEs</a><ul>
<li><a class="reference internal" href="#vs-code" id="id45">VS Code</a></li>
<li><a class="reference internal" href="#pycharm" id="id46">PyCharm</a></li>
<li><a class="reference internal" href="#atom" id="id47">Atom</a></li>
<li><a class="reference internal" href="#jupyter-notebook" id="id48">Jupyter notebook</a></li>
</ul>
</li>
<li><a class="reference internal" href="#awkward-questions" id="id49">Awkward questions</a><ul>
<li><a class="reference internal" href="#what-happens-if-i-activate-a-virtual-environment-while-i-ve-got-one-activated" id="id50">What happens if I activate a virtual environment while I've got one activated?</a></li>
<li><a class="reference internal" href="#can-i-deliberately-create-a-virtual-environment-that-depends-on-another" id="id51">Can I (deliberately) create a virtual environment that depends on another?</a></li>
<li><a class="reference internal" href="#how-do-i-stop-pip-from-installing-outside-a-virtual-environment" id="id52">How do I stop <tt class="docutils literal">pip</tt> from installing outside a virtual environment?</a></li>
<li><a class="reference internal" href="#do-i-need-to-activate-the-virtual-environment" id="id53">Do I <em>need</em> to activate the virtual environment?</a></li>
<li><a class="reference internal" href="#what-happens-when-i-upgrade-python" id="id54">What happens when I upgrade Python?</a><ul>
<li><a class="reference internal" href="#using-pipenv" id="id55">Using pipenv</a></li>
<li><a class="reference internal" href="#using-poetry" id="id56">Using poetry</a></li>
<li><a class="reference internal" href="#also" id="id57">Also...</a></li>
</ul>
</li>
<li><a class="reference internal" href="#what-about-an-existing-requirements-txt" id="id58">What about an existing requirements.txt?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-venv-directory-and-version-control-systems" id="id59">The venv directory and version control systems</a></li>
<li><a class="reference internal" href="#the-system-site-packages-switch" id="id60">The <tt class="docutils literal"><span class="pre">--system-site-packages</span></tt> switch</a></li>
<li><a class="reference internal" href="#multiple-pythons" id="id61">Multiple Pythons</a></li>
<li><a class="reference internal" href="#other-tools" id="id62">Other tools</a></li>
<li><a class="reference internal" href="#an-example-of-using-venv-on-windows-10" id="id63">An example of using <tt class="docutils literal">venv</tt> on Windows 10</a><ul>
<li><a class="reference internal" href="#installing-poetry" id="id64">Installing poetry</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interesting-links" id="id65">Interesting Links</a></li>
</ul>
</div>
<div class="section" id="why-do-we-need-virtual-environments">
<h1><a class="toc-backref" href="#id11">Why do we need virtual environments</a></h1>
<div class="section" id="shouldn-t-alter-the-system-python">
<h2><a class="toc-backref" href="#id12">Shouldn't alter the system Python</a></h2>
<p>Sometimes the Python provided by your operating system is actually acceptable.
This can, for instance happen with Linux systems, where you might be quite
happy with the version of Python installed by the system package mechanisms.</p>
<p>And if you're happy only using software that can be installed by this route
(e.g., by <tt class="docutils literal"><span class="pre">apt-get</span></tt> or <tt class="docutils literal">yum</tt> or whatever), then you <em>could</em> argue that you
don't need virtual environments.</p>
<p>However, in practice you are eventually likely to want to install something
more recent that your operating system provides, or perhaps a package that the
operating system tools don't make available.</p>
<p>The thing to remember here is:</p>
<blockquote>
Don't mix installing things by the operating system mechanisms and the
language-specific mechanisms.</blockquote>
<p>In other words, if you have an OS installed Python, don't try to update it
using <tt class="docutils literal">pip</tt>.</p>
<p>Luckily, most systems make this hard (on Linux you'd typically need to use
<tt class="docutils literal">sudo</tt>), which is a good hint not to do it!</p>
<p>Why not, though?</p>
<p>There are three reasons:</p>
<p>Firstly, it's quite possible that the OS itself is using that version of
Python, and if you change what is installed, you may break the things the OS
relies on. This is hard to detect beforehand.</p>
<p>Secondly, OS packaging solutions keep a record of what they have installed, so
they can correctly update or remove packages. If you &quot;go behind their back&quot;,
their recorded knowledge will be wrong, which can lead to problems when trying
to upgrade.</p>
<p>Thirdly, it still doesn't help with the &quot;need for different versions for
different purposes&quot; problem, that we will get to later on.</p>
</div>
<div class="section" id="can-t-alter-the-available-python">
<h2><a class="toc-backref" href="#id13">Can't alter the available Python</a></h2>
<p>Sometimes the person managing your computer doesn't let you alter the
available Python libraries. This may be for company legal reasons, or
whatever.</p>
<blockquote>
Note that <tt class="docutils literal">pip</tt> <em>does</em> actually let you install packages into a
user-local directory, but that relies on your remembering to do it,
and there's no obvious visibility that this has been done. And it still
doesn't addresss the &quot;need for different versions&quot; problem.</blockquote>
<p>Even if you could subvert that, you probably shouldn't.</p>
</div>
<div class="section" id="you-want-to-work-on-two-programs-that-have-conflicting-dependencies">
<h2><a class="toc-backref" href="#id14">You want to work on two programs that have conflicting dependencies</a></h2>
<p>This is the crux of it.</p>
<p>If you are working on existing packages, installed via <tt class="docutils literal">pip</tt>, then they will
automatically install their dependencies. But sometimes two packages depend on
mutually incompatible things - typically, different versions of a package or
set of packages.</p>
<p>So if project A needs versions 1 through 3 of a package, but won't work with 4
or higher, and project B needs at least version 5, then there is a problem
running them both at the same time.</p>
<p>Virtual environments are designed to make it easy to handle this, and also
relatively obvious that you are doing so.</p>
</div>
<div class="section" id="managing-dependencies">
<h2><a class="toc-backref" href="#id15">Managing dependencies</a></h2>
<p>A virtual environment lets you be explicit about what you have installed, and
that makes it easier to produce a proper package when you're developing.</p>
<p><tt class="docutils literal">pip freeze</tt> and <tt class="docutils literal">pipdeptree</tt></p>
</div>
<div class="section" id="but-also-tidiness">
<h2><a class="toc-backref" href="#id16">But also, tidiness</a></h2>
<p>Let us not also forget that we might want to keep things tidy.</p>
<p>If I'm working on project A, I might have a set of dependencies to do with,
perhaps, documentation tools, whereas for project B I need things for machine
learning, and for project C web development. Each of those can imply a large
number of Python packages (particularly the machine learning case), which
don't overlap much. There's no particular reason to have the unnecessary
packages available, and if we constrain our workspace a bit, it makes it
easier to reason about problems when they do occur.</p>
</div>
<div class="section" id="license-management">
<h2><a class="toc-backref" href="#id17">License management</a></h2>
<p>Having all the packages that are being used in one place makes it easier to
inspect them for license compliance.</p>
</div>
<div class="section" id="what-about-upgrading-python">
<h2><a class="toc-backref" href="#id18">What about upgrading Python?</a></h2>
<p>Virtual environments don't help directly (with upgrading Python and &quot;losing&quot;
the installed packages), but pipenv (check?) and poetry can.</p>
</div>
<div class="section" id="actual-use-cases">
<h2><a class="toc-backref" href="#id19">Actual use cases</a></h2>
<p>At our January meeting, we were told about <tt class="docutils literal">pypercard</tt>, which is a very nice
package, but has quite a few dependencies. If I want to play with it, then I
probably don't want to &quot;splash&quot; those dependencies all over my normal working
environment, especially if I'm also doing actual work with Python.</p>
<p>At work, we had two Python programs we needed to use in our build chain, but
they had incompatible version requirements of support libraries. The solution
was to use a different virtual environment for each.</p>
<p>Also at work, we wanted to know exactly which packages were needed for a
particular project. Again, running in a virtual environment meant we could
easily list the required packages, what version we had installed, and what
packages had been installed automatically as dependencies of other packages.</p>
</div>
</div>
<div class="section" id="the-examples">
<h1><a class="toc-backref" href="#id20">The Examples</a></h1>
<p>In general, where I say &quot;unix&quot;, that should include most common Linux
distributions, and also the BSDs and Mac OS. I assume your shell is something
like bash or zsh or even fish. For Windows, I assume Windows 10, and I assume
your shell is CMD.EXE or Powershell - I believe either should be OK. My
experience is more limited for Windows, but I shall include actual
screenshots.</p>
<p>The unix examples are from my Mac at home. The text is cut-and-pasted from
my terminal.</p>
<p>When you see <tt class="docutils literal">tibs ~$</tt> (or something similar) at the start of a line, that
is my prompt - everything up to the <tt class="docutils literal">$</tt>. So if you're following along, only
type the stuff after the <tt class="docutils literal">$</tt> (and the space that follows it).</p>
<p>For Windows, I've run Windows 10 in a virtual machine, and made screenshots.
Apologies for those - this seemed the simplest way to do it. I'll mostly only
talk about Windows when I'm talking about its differences from unix.</p>
<p>I <em>have</em> tried all the <tt class="docutils literal">venv</tt> examples on Windows, and I've installed and
checked <a class="reference external" href="https://python-poetry.org/">poetry</a>.</p>
</div>
<div class="section" id="python3-m-venv">
<h1><a class="toc-backref" href="#id21"><tt class="docutils literal">python3 <span class="pre">-m</span> venv</tt></a></h1>
<p>We're going to start by looking at the &quot;official&quot; way of creating and using
virtual environments, as of Python 3.3.</p>
<p>But first some preparation.</p>
<div class="section" id="make-a-working-directory">
<h2><a class="toc-backref" href="#id22">Make a working directory</a></h2>
<p>First, I make a directory to work in, and move there:</p>
<pre class="code bash literal-block">
tibs ~$ mkdir temp
tibs ~$ <span class="name builtin">cd</span> temp
tibs ~/temp$
</pre>
</div>
<div class="section" id="check-what-python-s-we-have-available">
<h2><a class="toc-backref" href="#id23">Check what Python(s) we have available</a></h2>
<p>Let's find out what version of Python I'm running - on my machine:</p>
<pre class="code bash literal-block">
tibs ~/temp$ python --version
Python <span class="literal number">2</span>.7.17
tibs ~/temp$ python3 --version
Python <span class="literal number">3</span>.7.6
</pre>
<p>I can investigate that a bit further:</p>
<pre class="code bash literal-block">
tibs ~/temp$ which python
/usr/local/bin/python
tibs ~/temp$ which python3
/usr/local/bin/python3
</pre>
<p>(On Windows, use <tt class="docutils literal">where python</tt> and <tt class="docutils literal">where python3</tt> respectively, which
will show you all the possible programs for each command - it's actually more
informative than <tt class="docutils literal">which</tt> on unix.)</p>
<p>As it happens, I installed the Python 3 myself, deliberately, and the Python 2
has been installed as a depencency of something else (otherwise I wouldn't
have bothered).</p>
<blockquote>
<p>My Mac does provide its own version of Python 2, but if I run it I get a
warning:</p>
<pre class="code bash literal-block">
tibs ~/temp$ /usr/bin/python

WARNING: Python <span class="literal number">2</span>.7 is not recommended.
This version is included in macOS <span class="keyword">for</span> compatibility with legacy software.
Future versions of macOS will not include Python <span class="literal number">2</span>.7.
Instead, it is recommended that you transition to using <span class="literal string single">'python3'</span> from within Terminal.

Python <span class="literal number">2</span>.7.16 <span class="operator">(</span>default, Nov  <span class="literal number">9</span> <span class="literal number">2019</span>, <span class="literal number">05</span>:55:08<span class="operator">)</span>
<span class="operator">[</span>GCC <span class="literal number">4</span>.2.1 Compatible Apple LLVM <span class="literal number">11</span>.0.0 <span class="operator">(</span>clang-1100.0.32.4<span class="operator">)</span> <span class="operator">(</span>-macos10.15-objc-s on darwin
Type <span class="literal string double">&quot;help&quot;</span>, <span class="literal string double">&quot;copyright&quot;</span>, <span class="literal string double">&quot;credits&quot;</span> or <span class="literal string double">&quot;license&quot;</span> <span class="keyword">for</span> more information.
&gt;&gt;&gt; exit<span class="operator">()</span>
</pre>
</blockquote>
</div>
<div class="section" id="create-a-virtual-environment">
<h2><a class="toc-backref" href="#id24">Create a virtual environment</a></h2>
<p>To create a new virtual environment with Python 3, I just need to do:</p>
<pre class="code bash literal-block">
tibs ~/temp$ python3 -m venv venv
</pre>
<p>and now if I look, I've got a new directory called <tt class="docutils literal">venv</tt>.</p>
<pre class="code bash literal-block">
tibs ~/temp$ ls
venv
</pre>
<p>Before going any further, let's unpack that command line a bit.</p>
<ul>
<li><p class="first"><tt class="docutils literal">python3</tt> is the Python I want to use to create the new virtual
environment. If I wanted to be specific about exactly which Python I wanted,
and assuming I've got them both installed, I could do:</p>
<pre class="code bash literal-block">
$ python3.6 -m venv venv
</pre>
<p>or:</p>
<pre class="code bash literal-block">
$ python3.7.1 -m venv venv
</pre>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">-m</span> venv</tt> tells Python to load the <tt class="docutils literal">venv</tt> module and run it.</p>
<p>The Python standard library comes with several modules that you can run in
this way. They all end with code like:</p>
<pre class="code python literal-block">
<span class="keyword">if</span> <span class="name variable magic">__name__</span> <span class="operator">==</span> <span class="literal string single">'__main__'</span><span class="punctuation">:</span>
    <span class="name">do_something</span><span class="punctuation">()</span>
</pre>
<p>In the case of <tt class="docutils literal">venv.py</tt>, that &quot;do something&quot; is to create the setup for a
virtual environment for this particular Python.</p>
</li>
<li><p class="first">that last <tt class="docutils literal">venv</tt> is the name of the directory to create which will hold
the &quot;workings&quot; of the virtual environment. I'll talk about how to choose a
name for this directory, and where to put it, later on, but for now the name
<tt class="docutils literal">venv</tt> is fairly self-explanatory, and the default place, the current
directory, is what we want.</p>
</li>
</ul>
</div>
<div class="section" id="activate-the-virtual-environment">
<h2><a class="toc-backref" href="#id25">Activate the virtual environment</a></h2>
<p>Now, <em>creating</em> that directory hasn't done anything else. In particular, it
hasn't activated the virtual environment.</p>
<blockquote>
I am embarrased to acknowledge how many times I've forgotten that!</blockquote>
<p>The next thing we need to do differs slightly depending on what shell we are
using. For bash and zsh, it's simply:</p>
<pre class="code bash literal-block">
tibs ~/temp$ <span class="name builtin">source</span> venv/bin/activate
</pre>
<p>If you're old fashioned and use csh, then you should do:</p>
<pre class="code bash literal-block">
tibs ~/temp$ <span class="name builtin">source</span> venv/bin/activate.csh
</pre>
<p>and if you use fish (as I do) then you do</p>
<pre class="code bash literal-block">
tibs ~/temp$ <span class="name builtin">source</span> venv/bin/activate.fish
</pre>
<p>Note that it <strong>will not work</strong> to do:</p>
<pre class="code bash literal-block">
tibs ~/temp$ venv/bin/activate
</pre>
<p>even though that <em>sounds</em> more sensible.</p>
<blockquote>
I always write the activation command using <tt class="docutils literal">source</tt>, even though most
shells also allow abbreviating that to <tt class="docutils literal">.</tt> (dot / period). Since it's hard
enough to remember that it needs to be sourced, I prefer the longer/more
obvious form.</blockquote>
<p>On Windows, if you're using CMD.EXE, you do:</p>
<pre class="literal-block">
&gt; venv\Scripts\activate.bat
</pre>
<p>and if you're using Powershell you do:</p>
<pre class="literal-block">
PS &gt; venv\Scripts\Activate.ps1
</pre>
<!--  -->
<blockquote>
Yes, windows works differently, so there's no equivalent to
<tt class="docutils literal">source</tt>. Which is nice.</blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Windows virtual environment directory provides activation
scripts for CMD.EXE and Powershell, as I've said, but it also always
includes the Bash activation script, as <tt class="docutils literal">venv\Scripts\activate</tt>, to
allow for Windows users who are using Bash.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using git bash (the bash installed with git on Windows) there
seem to be occasional problems. For instance, I did not have permission to
run the Python I had installed from the Windows App Store, but the Python
installed from python.org worked OK. Also, some problems were observed at
the CamPUG workshop in February 2020. However, if all goes well, you
should be able to use <tt class="docutils literal">venv/Scripts/activate</tt> to activate a git bash
environment in the normal manner.</p>
</div>
<p>In all cases, the next prompt should now start with <tt class="docutils literal">(venv)</tt> - that is, the
name of the virtual environment directory, in parentheses.</p>
<p>For instance, in my case:</p>
<pre class="literal-block">
.. code:: bash
</pre>
<blockquote>
tibs ~/temp$ source venv/bin/activate.fish
(venv) tibs ~/temp$</blockquote>
</div>
<div class="section" id="working-in-a-virtual-environment">
<h2><a class="toc-backref" href="#id26">Working in a virtual environment</a></h2>
<p>So our prompt now says:</p>
<pre class="literal-block">
.. code:: bash
</pre>
<blockquote>
(venv) tibs ~/temp$</blockquote>
<p>or something like that. What does that give us?</p>
<p>Well, the first thing is to make it more obvious what Python we're using.
Specifically:</p>
<pre class="code bash literal-block">
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ python3 --version
Python <span class="literal number">3</span>.7.6
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ python --version
Python <span class="literal number">3</span>.7.6
</pre>
<p>That is, the <tt class="docutils literal">python3</tt> command gives us Python 3.7.6, the Python we used to
create the venv, but now the <tt class="docutils literal">python</tt> command does as well.</p>
<p>We'll go into why that is later on, but for the moment, it's enough to notice
that both of those commands point &quot;inside&quot; the virtual environment directory:</p>
<pre class="code bash literal-block">
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ which python3
/Users/tibs/temp/venv/bin/python3
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ which python
/Users/tibs/temp/venv/bin/python
</pre>
<p>not to the &quot;original&quot; locations.</p>
<p>(and remember, on Windows, use <tt class="docutils literal">where</tt> instead of <tt class="docutils literal">which</tt>.)</p>
<p>...and actually, the same has been done for <tt class="docutils literal">pip</tt> and <tt class="docutils literal">pip3</tt> as well,
which makes of new packages installation just that bit easier.</p>
</div>
<div class="section" id="deactivating-a-virtual-environment">
<h2><a class="toc-backref" href="#id27">Deactivating a virtual environment</a></h2>
<p>Whatever shell or OS you are using, you just use the <tt class="docutils literal">deactivate</tt> command to
deactivate it:</p>
<pre class="code bash literal-block">
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ deactivate
tibs ~/temp$
</pre>
</div>
<div class="section" id="using-our-virtual-environment">
<h2><a class="toc-backref" href="#id28">Using our virtual environment</a></h2>
<p>So let's install something into our virtual environment.</p>
<p>First, we need to remember to re-activate it:</p>
<pre class="code bash literal-block">
tibs ~/temp$ <span class="name builtin">source</span> venv/bin/activate.fish
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$
</pre>
<p>and then we can install a package. I shall choose <tt class="docutils literal">requests</tt> - this is
actually a package that has caused me dependency clashes at work in the past,
even though it's generally very well behaved.</p>
<pre class="code bash literal-block">
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ pip install requests
Collecting requests
  Using cached https://files.pythonhosted.org/packages/51/bd/23c926cd341ea6b7dd0b2a00aba99ae0f828be89d72b2190f27c11d4b7fb/requests-2.22.0-py2.py3-none-any.whl
Collecting idna&lt;<span class="literal number">2</span>.9,&gt;<span class="operator">=</span><span class="literal number">2</span>.5 <span class="operator">(</span>from requests<span class="operator">)</span>
  Using cached https://files.pythonhosted.org/packages/14/2c/cd551d81dbe15200be1cf41cd03869a46fe7226e7450af7a6545bfc474c9/idna-2.8-py2.py3-none-any.whl
Collecting urllib3!<span class="operator">=</span><span class="literal number">1</span>.25.0,!<span class="operator">=</span><span class="literal number">1</span>.25.1,&lt;<span class="literal number">1</span>.26,&gt;<span class="operator">=</span><span class="literal number">1</span>.21.1 <span class="operator">(</span>from requests<span class="operator">)</span>
  Downloading https://files.pythonhosted.org/packages/e8/74/6e4f91745020f967d09332bb2b8b9b10090957334692eb88ea4afe91b77f/urllib3-1.25.8-py2.py3-none-any.whl <span class="operator">(</span>125kB<span class="operator">)</span>
    <span class="operator">||||||||||||||||||||||||||||||||||</span> 133kB <span class="literal number">2</span>.6MB/s
Collecting certifi&gt;<span class="operator">=</span><span class="literal number">2017</span>.4.17 <span class="operator">(</span>from requests<span class="operator">)</span>
  Using cached https://files.pythonhosted.org/packages/b9/63/df50cac98ea0d5b006c55a399c3bf1db9da7b5a24de7890bc9cfd5dd9e99/certifi-2019.11.28-py2.py3-none-any.whl
Collecting chardet&lt;<span class="literal number">3</span>.1.0,&gt;<span class="operator">=</span><span class="literal number">3</span>.0.2 <span class="operator">(</span>from requests<span class="operator">)</span>
  Using cached https://files.pythonhosted.org/packages/bc/a9/01ffebfb562e4274b6487b4bb1ddec7ca55ec7510b22e4c51f14098443b8/chardet-3.0.4-py2.py3-none-any.whl
Installing collected packages: idna, urllib3, certifi, chardet, requests
Successfully installed certifi-2019.11.28 chardet-3.0.4 idna-2.8 requests-2.22.0 urllib3-1.25.8
WARNING: You are using pip version <span class="literal number">19</span>.2.3, however version <span class="literal number">20</span>.0.2 is available.
You should consider upgrading via the <span class="literal string single">'pip install --upgrade pip'</span> command.
</pre>
<p>Anyway, that's also given us some good advice. When we create a virtual
environment, it puts a version of <tt class="docutils literal">pip</tt> into it for us, but it only knows
about the version that comes with that version of Python.</p>
<blockquote>
Interesting aside: you can do <tt class="docutils literal">python3 <span class="pre">-m</span> pip</tt> to use that specific <tt class="docutils literal">pip</tt></blockquote>
<p>Anyway, it's telling us there is a more recent version of <tt class="docutils literal">pip</tt>, and
generally we want to use the most recent version, so let's update it as we
were told:</p>
<pre class="code bash literal-block">
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ pip install --upgrade pip
Collecting pip
  Downloading https://files.pythonhosted.org/packages/54/0c/d01aa759fdc501a58f431eb594a17495f15b88da142ce14b5845662c13f3/pip-20.0.2-py2.py3-none-any.whl <span class="operator">(</span><span class="literal number">1</span>.4MB<span class="operator">)</span>
    <span class="operator">||||||||||||||||||||||||||||||||||</span> <span class="literal number">1</span>.4MB <span class="literal number">2</span>.8MB/s
Installing collected packages: pip
  Found existing installation: pip <span class="literal number">19</span>.2.3
    Uninstalling pip-19.2.3:
      Successfully uninstalled pip-19.2.3
Successfully installed pip-20.0.2
</pre>
<p>Let's check what we've done:</p>
<pre class="code bash literal-block">
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ pip --version
pip <span class="literal number">20</span>.0.2 from /Users/tibs/temp/venv/lib/python3.7/site-packages/pip <span class="operator">(</span>python <span class="literal number">3</span>.7<span class="operator">)</span>
</pre>
<p>and to prove we've got the <tt class="docutils literal">requests</tt> package installed:</p>
<pre class="code bash literal-block">
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ python
Python <span class="literal number">3</span>.7.6 <span class="operator">(</span>default, Jan <span class="literal number">28</span> <span class="literal number">2020</span>, <span class="literal number">22</span>:16:20<span class="operator">)</span>
<span class="operator">[</span>Clang <span class="literal number">11</span>.0.0 <span class="operator">(</span>clang-1100.0.33.16<span class="operator">)]</span> on darwin
Type <span class="literal string double">&quot;help&quot;</span>, <span class="literal string double">&quot;copyright&quot;</span>, <span class="literal string double">&quot;credits&quot;</span> or <span class="literal string double">&quot;license&quot;</span> <span class="keyword">for</span> more information.
&gt;&gt;&gt; import requests
&gt;&gt;&gt; exit<span class="operator">()</span>
</pre>
<pre class="code bash literal-block">
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ deactivate
tibs ~/temp$
</pre>
<p>As you can see, this puts the prompt back to normal as well.</p>
<p>And now we're back to the versions of Python outside the virtual environment:</p>
<pre class="code bash literal-block">
tibs ~/temp$ python --version
Python <span class="literal number">2</span>.7.17
tibs ~/temp$
tibs ~/temp$ pip --version
pip <span class="literal number">19</span>.3.1 from /usr/local/lib/python2.7/site-packages/pip <span class="operator">(</span>python <span class="literal number">2</span>.7<span class="operator">)</span>
tibs ~/temp$
tibs ~/temp$ python3
Python <span class="literal number">3</span>.7.6 <span class="operator">(</span>default, Jan <span class="literal number">28</span> <span class="literal number">2020</span>, <span class="literal number">22</span>:16:20<span class="operator">)</span>
<span class="operator">[</span>Clang <span class="literal number">11</span>.0.0 <span class="operator">(</span>clang-1100.0.33.8<span class="operator">)]</span> on darwin
Type <span class="literal string double">&quot;help&quot;</span>, <span class="literal string double">&quot;copyright&quot;</span>, <span class="literal string double">&quot;credits&quot;</span> or <span class="literal string double">&quot;license&quot;</span> <span class="keyword">for</span> more information.
&gt;&gt;&gt; import requests
Traceback <span class="operator">(</span>most recent call last<span class="operator">)</span>:
  File <span class="literal string double">&quot;&lt;stdin&gt;&quot;</span>, line <span class="literal number">1</span>, in &lt;module&gt;
ModuleNotFoundError: No module named <span class="literal string single">'requests'</span>
&gt;&gt;&gt; exit<span class="operator">()</span>
</pre>
<p>In other words, the changes we made in the virtual environment have &quot;gone
away&quot;.</p>
<p>And, if we reactivate, they will &quot;come back&quot; again.</p>
</div>
</div>
<div class="section" id="how-it-works">
<h1><a class="toc-backref" href="#id29">How it works</a></h1>
<p>(what is in the <tt class="docutils literal">venv</tt> directory)</p>
<pre class="code bash literal-block">
tibs ~/temp$ ls -F venv
bin/        include/    lib/        pyvenv.cfg
</pre>
<pre class="code bash literal-block">
tibs ~/temp$ more venv/pyvenv.cfg
<span class="name variable">home</span> <span class="operator">=</span> /usr/local/bin
include-system-site-packages <span class="operator">=</span> <span class="name builtin">false</span>
<span class="name variable">version</span> <span class="operator">=</span> <span class="literal number">3</span>.7.6
</pre>
<pre class="code bash literal-block">
tibs ~/temp$ ls -F venv/bin/
activate          chardetect*       pip*              python&#64;
activate.csh      easy_install*     pip3*             python3&#64;
activate.fish     easy_install-3.7* pip3.7*
</pre>
<pre class="code bash literal-block">
tibs ~/temp$ ls -l venv/bin/python
lrwxr-xr-x  <span class="literal number">1</span> tibs  staff  <span class="literal number">7</span> <span class="literal number">19</span> Jan <span class="literal number">16</span>:50 venv/bin/python -&gt; python3
tibs ~/temp$ ls -l venv/bin/python3
lrwxr-xr-x  <span class="literal number">1</span> tibs  staff  <span class="literal number">22</span> <span class="literal number">19</span> Jan <span class="literal number">16</span>:50 venv/bin/python3 -&gt; /usr/local/bin/python3
</pre>
<pre class="code bash literal-block">
tibs ~/temp$ ls venv/include
</pre>
<pre class="code bash literal-block">
tibs ~/temp$ ls -F venv/lib
python3.7/
tibs ~/temp$ ls -F venv/lib/python3.7
site-packages/
</pre>
<pre class="code bash literal-block">
tibs ~/temp$ ls -F venv/lib/python3.7/site-packages
__pycache__/                  pip-20.0.2.dist-info/
certifi/                      pkg_resources/
certifi-2019.11.28.dist-info/ requests/
chardet/                      requests-2.22.0.dist-info/
chardet-3.0.4.dist-info/      setuptools/
easy_install.py               setuptools-41.2.0.dist-info/
idna/                         urllib3/
idna-2.8.dist-info/           urllib3-1.25.8.dist-info/
pip/
</pre>
<p>By contrast, if I create another virtual environment (<tt class="docutils literal">venv2</tt>) and don't
install anything in it, <em>its</em> <tt class="docutils literal">venv2/lib</tt> looks like:</p>
<pre class="code bash literal-block">
tibs ~/temp$ ls -F venv2/lib/python3.7/site-packages/
__pycache__/                    pkg_resources/
easy_install.py                 setuptools/
pip/                            setuptools-41.2.0.dist-info/
pip-19.2.3.dist-info/
</pre>
</div>
<div class="section" id="finding-out-what-is-installed">
<h1><a class="toc-backref" href="#id30">Finding out what is installed</a></h1>
<div class="section" id="pip-freeze">
<h2><a class="toc-backref" href="#id31"><tt class="docutils literal">pip freeze</tt></a></h2>
<p>Back in the original virtual environment, after installing <tt class="docutils literal">requests</tt>:</p>
<pre class="code bash literal-block">
tibs ~/temp$ <span class="name builtin">source</span> venv/bin/activate.fish
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ pip freeze
<span class="name variable">certifi</span><span class="operator">==</span><span class="literal number">2019</span>.11.28
<span class="name variable">chardet</span><span class="operator">==</span><span class="literal number">3</span>.0.4
<span class="name variable">idna</span><span class="operator">==</span><span class="literal number">2</span>.8
<span class="name variable">requests</span><span class="operator">==</span><span class="literal number">2</span>.22.0
<span class="name variable">urllib3</span><span class="operator">==</span><span class="literal number">1</span>.25.8
</pre>
<p>It's called <tt class="docutils literal">freeze</tt> because this command is originally intended for
creating a file listing exactly the package versions installed. <tt class="docutils literal">pip</tt> can
then be given that text file and reproduce the same installation.</p>
<p>So, for instance:</p>
<pre class="code bash literal-block">
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ pip freeze &gt; requirements.txt
</pre>
<p>and then elsewhere, use the same <tt class="docutils literal">requirements.txt</tt> file:</p>
<pre class="code bash literal-block">
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ pip install -r requirements.txt
</pre>
</div>
<div class="section" id="pipdeptree">
<h2><a class="toc-backref" href="#id32"><tt class="docutils literal">pipdeptree</tt></a></h2>
<p><a class="reference external" href="https://github.com/naiquevin/pipdeptree">https://github.com/naiquevin/pipdeptree</a>
and <a class="reference external" href="https://pypi.org/project/pipdeptree/">https://pypi.org/project/pipdeptree/</a></p>
<p>This is a very useful package for showing what is installed, and why (i.e.,
what package needed another package). It can also be very useful for
diagnosing problems (for instance, if the dependency resolution of <tt class="docutils literal">pip</tt>
gets confused and it can't work out what versions of what it needs).</p>
<pre class="code bash literal-block">
tibs ~/temp$ <span class="name builtin">source</span> venv/bin/activate.fish
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ pip install pipdeptree
Collecting pipdeptree
  Downloading pipdeptree-0.13.2-py3-none-any.whl <span class="operator">(</span><span class="literal number">16</span> kB<span class="operator">)</span>
Requirement already satisfied: pip&gt;<span class="operator">=</span><span class="literal number">6</span>.0.0 in ./venv/lib/python3.7/site-packages <span class="operator">(</span>from pipdeptree<span class="operator">)</span> <span class="operator">(</span><span class="literal number">20</span>.0.2<span class="operator">)</span>
Installing collected packages: pipdeptree
Successfully installed pipdeptree-0.13.2
</pre>
<p>and then:</p>
<pre class="code bash literal-block">
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ pipdeptree
<span class="name variable">pipdeptree</span><span class="operator">==</span><span class="literal number">0</span>.13.2
  - pip <span class="operator">[</span>required: &gt;<span class="operator">=</span><span class="literal number">6</span>.0.0, installed: <span class="literal number">20</span>.0.2<span class="operator">]</span>
<span class="name variable">requests</span><span class="operator">==</span><span class="literal number">2</span>.22.0
  - certifi <span class="operator">[</span>required: &gt;<span class="operator">=</span><span class="literal number">2017</span>.4.17, installed: <span class="literal number">2019</span>.11.28<span class="operator">]</span>
  - chardet <span class="operator">[</span>required: &gt;<span class="operator">=</span><span class="literal number">3</span>.0.2,&lt;<span class="literal number">3</span>.1.0, installed: <span class="literal number">3</span>.0.4<span class="operator">]</span>
  - idna <span class="operator">[</span>required: &gt;<span class="operator">=</span><span class="literal number">2</span>.5,&lt;<span class="literal number">2</span>.9, installed: <span class="literal number">2</span>.8<span class="operator">]</span>
  - urllib3 <span class="operator">[</span>required: &gt;<span class="operator">=</span><span class="literal number">1</span>.21.1,&lt;<span class="literal number">1</span>.26,!<span class="operator">=</span><span class="literal number">1</span>.25.1,!<span class="operator">=</span><span class="literal number">1</span>.25.0, installed: <span class="literal number">1</span>.25.8<span class="operator">]</span>
<span class="name variable">setuptools</span><span class="operator">==</span><span class="literal number">41</span>.2.0
</pre>
<p>This not only tells us what is installed and at what version, but what
packages needed it, and what versions they were happy to accept.</p>
<p>There's quite a lot more this tool can do - go and look at the website to see
its documentation.</p>
</div>
</div>
<div class="section" id="where-to-put-the-venv-directory">
<h1><a class="toc-backref" href="#id33">Where to put the venv directory</a></h1>
<div class="section" id="project-one-venv-per-directory-tree">
<h2><a class="toc-backref" href="#id34">&quot;project&quot; - one venv per directory tree</a></h2>
<p>This is a natural way to work - for instance, to have a <tt class="docutils literal">~/work</tt> directory,
and inside it a sub-directory for each project, and each of those contains its
own <tt class="docutils literal">venv</tt>.</p>
<p>When you <tt class="docutils literal">cd</tt> into a directory, you activate its virtual environment.</p>
<p>This works well if you use one terminal window per project, and also works
well with IDEs, which generally like to identify a project directory tree.</p>
<p>There are also tools like <tt class="docutils literal">direnv</tt> (see <a class="reference internal" href="#other-tools">other tools</a>) which will
facilitate this by actually starting up the virtualenv when you <tt class="docutils literal">cd</tt> into
the directory tree.</p>
<p>One of the reasons this works well is it makes it fairly easy to remember
which virtual environment you <em>should</em> be using.</p>
<p>I've used this at work, where my Python code tended to be organised in this
manner.</p>
<p>This is also the sort of way of working that both <tt class="docutils literal">pipenv</tt> and <tt class="docutils literal">poetry</tt>
encourage, because they look in the current directory and &quot;upwards&quot; to find
the specification of which virtual environment to use. Regardless, both
(certainly <tt class="docutils literal">pipenv</tt>) keep the actual virtual environment directories in a
central place - this makes it easier for the programs to manage them.</p>
</div>
<div class="section" id="environment-one-venv-per-purpose">
<h2><a class="toc-backref" href="#id35">&quot;environment&quot; - one venv per purpose</a></h2>
<blockquote>
(The name &quot;environment&quot; isn't as good a name for this, but it will do.)</blockquote>
<p>This works well if you like to keep one setup for each type of work.</p>
<p>For instance, one environment for documentation work (docutils, sphinx, etc.),
regardless of where it is. Perhaps another for using numpy/scipy and so on.</p>
<p>I've tended to use this arrangement more at home.</p>
<p>This relies a lot more no actually keeping an eye on the prompt, to make sure
that the right virtual environment for the current purpose is in force.</p>
<p>If you're working this way, you almost certainly want to keep the virtual
environment directories in a central place. On Linux this would typically be
in <tt class="docutils literal">~/venv/</tt> or <tt class="docutils literal"><span class="pre">~/.venv/</span></tt> or perhaps somewhere like <tt class="docutils literal">~/local/share/virtualenvs/</tt>.</p>
</div>
</div>
<div class="section" id="python3-m-venv-help">
<h1><a class="toc-backref" href="#id36"><tt class="docutils literal">python3 <span class="pre">-m</span> venv help</tt></a></h1>
<p>Note that <tt class="docutils literal">python3 <span class="pre">-m</span> venv</tt> works like a &quot;proper&quot; command, in that it can
take a variety of arguments, and even has help:</p>
<pre class="code bash literal-block">
$ python3 -m venv --help
usage: venv <span class="operator">[</span>-h<span class="operator">]</span> <span class="operator">[</span>--system-site-packages<span class="operator">]</span> <span class="operator">[</span>--symlinks <span class="punctuation">|</span> --copies<span class="operator">]</span> <span class="operator">[</span>--clear<span class="operator">]</span>
            <span class="operator">[</span>--upgrade<span class="operator">]</span> <span class="operator">[</span>--without-pip<span class="operator">]</span> <span class="operator">[</span>--prompt PROMPT<span class="operator">]</span>
            ENV_DIR <span class="operator">[</span>ENV_DIR ...<span class="operator">]</span>

Creates virtual Python environments in one or more target directories.

positional arguments:
  ENV_DIR               A directory to create the environment in.

optional arguments:
  -h, --help            show this <span class="name builtin">help</span> message and <span class="name builtin">exit</span>
  --system-site-packages
                        Give the virtual environment access to the system
                        site-packages dir.
  --symlinks            Try to use symlinks rather than copies, when symlinks
                        are not the default <span class="keyword">for</span> the platform.
  --copies              Try to use copies rather than symlinks, even when
                        symlinks are the default <span class="keyword">for</span> the platform.
  --clear               Delete the contents of the environment directory <span class="keyword">if</span> it
                        already exists, before environment creation.
  --upgrade             Upgrade the environment directory to use this version
                        of Python, assuming Python has been upgraded in-place.
  --without-pip         Skips installing or upgrading pip in the virtual
                        environment <span class="operator">(</span>pip is bootstrapped by default<span class="operator">)</span>
  --prompt PROMPT       Provides an alternative prompt prefix <span class="keyword">for</span> this
                        environment.

Once an environment has been created, you may wish to activate it, e.g. by
sourcing an activate script in its bin directory.
</pre>
</div>
<div class="section" id="wrappers-to-make-it-easier">
<h1><a class="toc-backref" href="#id37">Wrappers to make it easier</a></h1>
<div class="section" id="virtualenv">
<h2><a class="toc-backref" href="#id38">virtualenv</a></h2>
<p><a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a> is essentially where Python virtual envrironments all started.</p>
<blockquote>
(Well, actually it looks as if <a class="reference external" href="https://pypi.org/project/workingenv.py/0.1/">workingenv 0.1</a> is where it all started,
but virtualenv took over in <a class="reference external" href="http://www.ianbicking.org/blog/2007/10/workingenv-is-dead-long-live-virtualenv.html">2007</a>. And anyway both are by the same author,
Ian Bicking.)</blockquote>
<p>That does mean that if you want virtual environments for Python2 or early
versions of Python 3, this is still the package to use.</p>
<hr class="docutils" />
<p>Back in my <tt class="docutils literal">temp</tt> directory, but I delete the existing <tt class="docutils literal">venv</tt> directory.</p>
<p>The command <tt class="docutils literal">virtualenv NAME</tt> will create a virtual environment called
<tt class="docutils literal">NAME</tt>, using the same Python that was used to install <tt class="docutils literal">virtualenv</tt>.</p>
<p>To get a specific Python, use the <tt class="docutils literal"><span class="pre">-p</span></tt> (<tt class="docutils literal"><span class="pre">--python</span></tt>) switch:</p>
<pre class="code bash literal-block">
tibs ~/temp$ virtualenv -p python3.7 VENV
Running virtualenv with interpreter /usr/local/bin/python3.7
Already using interpreter /usr/local/opt/python/bin/python3.7
Using base prefix <span class="literal string single">'/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7'</span>
New python executable in /Users/tibs/temp/VENV/bin/python3.7
Also creating executable in /Users/tibs/temp/VENV/bin/python
Installing setuptools, pip, wheel...
<span class="keyword">done</span>.
</pre>
<p>and that has created a directory called <tt class="docutils literal">VENV</tt>, as one might expect:</p>
<pre class="code bash literal-block">
tibs ~/temp$ ls -F VENV
bin/     include/ lib/
</pre>
<p>There is also a &quot;hidden&quot; file in there, a link:</p>
<pre class="code bash literal-block">
tibs ~/temp$ ls -l VENV/.Python
lrwxr-xr-x  <span class="literal number">1</span> tibs  staff  <span class="literal number">80</span>  <span class="literal number">1</span> Feb <span class="literal number">16</span>:43 VENV/.Python -&gt; /usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/Python
</pre>
<p>Note that there isn't a <tt class="docutils literal">pyenv.cfg</tt> file - that's a later invention.</p>
<p>The <tt class="docutils literal">bin</tt> directory looks like:</p>
<pre class="code bash literal-block">
tibs ~/temp$ ls -F VENV/bin/
activate          activate.xsh      pip*              python-config*
activate.csh      activate_this.py  pip3*             python3&#64;
activate.fish     easy_install*     pip3.7*           python3.7*
activate.ps1      easy_install-3.7* python&#64;           wheel*
</pre>
<p>Once you've created the virtual environment, it works much as the <tt class="docutils literal">venv</tt>
style virtual environment - in particular, you activate and deactivate it in
the same way.</p>
<p>The <a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a> documentation contains <a class="reference external" href="https://virtualenv.pypa.io/en/latest/reference/#compatibility-with-the-stdlib-venv-module">information</a> on how it relates to the
<tt class="docutils literal">venv</tt> provided by Python 3.3 and later. You can probably ignore that unless
you're trying to nest virtual environments of the two types, or are trying to
write Python code to manage both sorts of virtual environments.</p>
<p>As one might expect, <a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a> also works on Windows.</p>
<p><a class="reference external" href="https://www.jetbrains.com/pycharm/">PyCharm</a> assumes that you use <a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a> to manage your virtual environments.</p>
<p>My recommendation: unless you have good reason to use <a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a>, just use
<tt class="docutils literal">python3 <span class="pre">-m</span> venv</tt>.</p>
<p>(NB: install with <tt class="docutils literal">pip</tt> or your system package manager. That first is
something of a bootstrap problem, which is probably a big part of why <tt class="docutils literal">venv</tt>
got added to Python 3 - that and the fact that virtual environments are now a
standard thing, which they clearly weren't when <a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a> was invented.)</p>
</div>
<div class="section" id="virtualenvwrapper">
<h2><a class="toc-backref" href="#id39">virtualenvwrapper</a></h2>
<p><a class="reference external" href="https://virtualenvwrapper.readthedocs.io">virtualenvwrapper</a> is a wrapper for <a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a> (well, it's in the name!) that
aims to make it easier to use, by providing some extra commands.</p>
<p>Once you've installed it, there's a degree of manual setup, although it's
reasonable clearly explained in the documentation.</p>
<p>Once you've set it up, it will:</p>
<ol class="arabic simple">
<li>Allow you to keep all of your virtual environment directories under one
single directory - typically something like <tt class="docutils literal"><span class="pre">$HOME/.virtualenvs</span></tt>.</li>
<li>Provide a new command, <tt class="docutils literal">mkvirtualenv</tt> to create new virtual
environments.</li>
<li>Provide a command <tt class="docutils literal">workon</tt> that lets you change to a (different) virtual
environment.</li>
</ol>
<p>So, for instance, I might do:</p>
<pre class="code bash literal-block">
tibs ~/temp$ mkvirtualenv use-requests
</pre>
<p>which would create me a virtual environment directory:</p>
<pre class="literal-block">
/Users/tibs/.virtualenvs/use-requests
</pre>
<p>The <em>content</em> of that directory would be the same as if it had been created
directly using <a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a>.</p>
<p>To <em>use</em> that virtual environment, I would just use the <tt class="docutils literal">workon</tt> command:</p>
<pre class="code bash literal-block">
tibs ~/temp$ workon use-requests
<span class="operator">(</span>use-requests<span class="operator">)</span> tibs ~/temp$
</pre>
<p>To change to another virtual environment (created with <tt class="docutils literal">mkvirtualenv</tt>) I can
use the <tt class="docutils literal">workon</tt> command with the name of that new virtual environment - it
will <tt class="docutils literal">deactivate</tt> and then activate the new environment for me.</p>
<p>And, of course, because it is still a <a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a> environment, I can
<tt class="docutils literal">deactivate</tt> by hand if I wish:
.. code:: bash</p>
<blockquote>
(use-requests) tibs ~/temp$ deactivate
tibs ~/temp$</blockquote>
<p>Notes:</p>
<ul class="simple">
<li><a class="reference external" href="https://virtualenvwrapper.readthedocs.io">virtualenvwrapper</a> is (mostly) a set of shell scripts, written in bash, ksh
and zsh, so it won't work outside those environments (even though
<a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a> does). However, if you really want a <a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a> wrapper, other
people have written similar things;<ul>
<li>For Windows, there is <a class="reference external" href="https://pypi.org/project/virtualenvwrapper-win/">virtualenvwrapper-win</a> which says it works in
CMD.EXE, but not in Powershell</li>
<li>For the fish shell (which I use), there's <a class="reference external" href="https://github.com/excitedleigh/virtualfish">virtualfish</a></li>
</ul>
</li>
<li>I <em>have</em> used <a class="reference external" href="https://virtualenvwrapper.readthedocs.io">virtualenvwrapper</a> in the past, but nowadays I just use the
<tt class="docutils literal">venv</tt> support in modern Python 3.</li>
<li><a class="reference external" href="https://virtualenvwrapper.readthedocs.io">virtualenvwrapper</a> is installed with pip, so some of the same comments as
for <a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a> apply.</li>
</ul>
</div>
<div class="section" id="pipenv">
<h2><a class="toc-backref" href="#id40">pipenv</a></h2>
<p><a class="reference external" href="https://pipenv.readthedocs.io/">pipenv</a> aims to make using virtual environments easier, but also to help with
package management for a project as well.</p>
<p>(Note that pipenv uses some odd characters in its output, to try to be
&quot;amusing&quot;. Which is nice enough, but I've had to replace them with <tt class="docutils literal">?</tt> in
this file.)</p>
<p>To start using it:</p>
<pre class="code bash literal-block">
tibs ~/temp$ <span class="name builtin">cd</span> ~/temp
tibs ~/temp$ pipenv install --python <span class="literal number">3</span>.7
Creating a virtualenv <span class="keyword">for</span> this project…
Pipfile: /Users/tibs/temp/Pipfile
Using /usr/local/bin/python3 <span class="operator">(</span><span class="literal number">3</span>.7.6<span class="operator">)</span> to create virtualenv…
? Creating virtual environment...Already using interpreter /usr/local/opt/python/bin/python3.7
Using base prefix <span class="literal string single">'/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7'</span>
New python executable in /Users/tibs/.local/share/virtualenvs/temp--1EXmzEU/bin/python3.7
Also creating executable in /Users/tibs/.local/share/virtualenvs/temp--1EXmzEU/bin/python
Installing setuptools, pip, wheel...
<span class="keyword">done</span>.
Running virtualenv with interpreter /usr/local/bin/python3

? Successfully created virtual environment!
Virtualenv location: /Users/tibs/.local/share/virtualenvs/temp--1EXmzEU
Creating a Pipfile <span class="keyword">for</span> this project…
Pipfile.lock not found, creating…
Locking <span class="operator">[</span>dev-packages<span class="operator">]</span> dependencies…
Locking <span class="operator">[</span>packages<span class="operator">]</span> dependencies…
Updated Pipfile.lock <span class="operator">(</span>a65489<span class="operator">)</span>!
Installing dependencies from Pipfile.lock <span class="operator">(</span>a65489<span class="operator">)</span>…
? <span class="operator">||||||||||||||||||||||||||||||||</span> <span class="literal number">0</span>/0 — <span class="literal number">00</span>:00:00
To activate this project<span class="error">'</span>s virtualenv, run pipenv shell.
Alternatively, run a <span class="name builtin">command</span> inside the virtualenv with pipenv run.
</pre>
<p>As it says, this has put a new virtual environment in a &quot;standard&quot; place,
which on unix is <tt class="docutils literal"><span class="pre">~/.local/share/virtualenvs</span></tt>. It has also automatically
named that virtual environment, using the current directory name and a unique
hash code.</p>
<p>If I look in that directory:</p>
<pre class="code bash literal-block">
<span class="operator">(</span>temp<span class="operator">)</span> tibs ~/temp$ ls -aF ~/.local/share/virtualenvs/temp--1EXmzEU/
./        ../       .Python&#64;  .project  bin/      include/  lib/
</pre>
<p>then I can see that this is a <a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a> style virtual environment, not a
<tt class="docutils literal">venv</tt> style.</p>
<p>It has also created two files in the current directory:</p>
<pre class="code bash literal-block">
tibs ~/temp$ ls -F
Pipfile       Pipfile.lock
</pre>
<p>The <tt class="docutils literal">Pipfile</tt> gives a description of the newly created virtual environment:</p>
<pre class="literal-block">
[[source]]
name = &quot;pypi&quot;
url = &quot;https://pypi.org/simple&quot;
verify_ssl = true

[dev-packages]

[packages]

[requires]
python_version = &quot;3.7&quot;
</pre>
<p>and the <tt class="docutils literal">Pipfile.lock</tt> gets more specific and less human-readable:</p>
<pre class="literal-block">
{
    &quot;_meta&quot;: {
        &quot;hash&quot;: {
            &quot;sha256&quot;: &quot;7e7ef69da7248742e869378f8421880cf8f0017f96d94d086813baa518a65489&quot;
        },
        &quot;pipfile-spec&quot;: 6,
        &quot;requires&quot;: {
            &quot;python_version&quot;: &quot;3.7&quot;
        },
        &quot;sources&quot;: [
            {
                &quot;name&quot;: &quot;pypi&quot;,
                &quot;url&quot;: &quot;https://pypi.org/simple&quot;,
                &quot;verify_ssl&quot;: true
            }
        ]
    },
    &quot;default&quot;: {},
    &quot;develop&quot;: {}
}
</pre>
<p>The normal way to use the virtual environment is then (as it suggests) to do:</p>
<pre class="code bash literal-block">
tibs ~/temp$ pipenv shell                                                               I
Launching subshell in virtual environment…
Welcome to fish, the friendly interactive shell
tibs ~/temp$  <span class="name builtin">source</span> /Users/tibs/.local/share/virtualenvs/temp--1EXmzEU/bin/activate.fish

<span class="operator">(</span>temp<span class="operator">)</span> tibs ~/temp$
</pre>
<p>This actually starts a new shell with the virtual environment enabled in it.</p>
<p>(So, to get out of the environment, I just use <tt class="docutils literal"><span class="pre">CTRL-D</span></tt> or <tt class="docutils literal">exit</tt> as I
normally would to get out of a unix subshell.)</p>
<p>With <a class="reference external" href="https://pipenv.readthedocs.io/">pipenv</a>, I use it (and not <tt class="docutils literal">pip</tt>) to install new packages:</p>
<pre class="code bash literal-block">
<span class="operator">(</span>temp<span class="operator">)</span> tibs ~/temp$ pipenv install requests
Installing requests…
Adding requests to Pipfile<span class="error">'</span>s <span class="operator">[</span>packages<span class="operator">]</span>…
? Installation Succeeded
Pipfile.lock <span class="operator">(</span>444a6d<span class="operator">)</span> out of date, updating to <span class="operator">(</span>a65489<span class="operator">)</span>…
Locking <span class="operator">[</span>dev-packages<span class="operator">]</span> dependencies…
Locking <span class="operator">[</span>packages<span class="operator">]</span> dependencies…
? Success!
Updated Pipfile.lock <span class="operator">(</span>444a6d<span class="operator">)</span>!
Installing dependencies from Pipfile.lock <span class="operator">(</span>444a6d<span class="operator">)</span>…
? <span class="operator">||||||||||||||||||||||||||||||||</span> <span class="literal number">5</span>/5 — <span class="literal number">00</span>:00:00
</pre>
<p>Now the <tt class="docutils literal">Pipfile</tt> and <tt class="docutils literal">Pipfile.lock</tt> have been updated - the <tt class="docutils literal">Pipfile</tt>
to:</p>
<pre class="literal-block">
[[source]]
name = &quot;pypi&quot;
url = &quot;https://pypi.org/simple&quot;
verify_ssl = true

[dev-packages]

[packages]
requests = &quot;*&quot;

[requires]
python_version = &quot;3.7&quot;
</pre>
<p>and the <tt class="docutils literal">Pipfile.lock</tt> to something rather longer and more complicated, but
which basically uniquely identifies the packages that were installed.</p>
<p>The <tt class="docutils literal">Pipfile.lock</tt> is intended to contain all the information that is needed
to recreate exactly this virtual environment. If there is a <tt class="docutils literal">Pipfile.lock</tt>
in a directory, and you give the <tt class="docutils literal">pipenv install</tt> command with no packages,
it will set up the virtual environment to match that described in the lock
file.</p>
<p>Notes:</p>
<ul class="simple">
<li>This all works on Windows 10 as well.</li>
<li><a class="reference external" href="https://pipenv.readthedocs.io/">pipenv</a> has always worked with Python 2 and Python 3, and took the decision
to use <a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a> environments for both. I don't know if it will ever move
towards supporting <tt class="docutils literal">venv</tt> environments instead.</li>
<li>If you have a <tt class="docutils literal">requirements.txt</tt> file in the current directory (the one
in which you are running <tt class="docutils literal">pipenv install</tt>) or its parent(s), then <a class="reference external" href="https://pipenv.readthedocs.io/">pipenv</a>
will try to use it to set up your environment. That can be surprising if
the file is <em>not</em> one you meant to use for this purpose!</li>
<li>You <em>can</em> use <tt class="docutils literal">pip install</tt> inside a <a class="reference external" href="https://pipenv.readthedocs.io/">pipenv</a> virtual environment, and it
will install the package you ask for, but it won't update the <tt class="docutils literal">Pipfile</tt> or
<tt class="docutils literal">Pipfile.lock</tt>. I've fallen over that more than once in the past.</li>
<li>There is some slightly complicated political history to the <a class="reference external" href="https://pipenv.readthedocs.io/">pipenv</a> project.</li>
</ul>
</div>
<div class="section" id="poetry">
<h2><a class="toc-backref" href="#id41">poetry</a></h2>
<blockquote class="epigraph">
<p>I built Poetry because I wanted a single tool to manage my Python projects
from start to finish. I wanted something reliable and intuitive that the
community could use and enjoy.</p>
<p class="attribution">&mdash;Sébastien Eustace</p>
</blockquote>
<p>If you want to create a new project, then the <tt class="docutils literal">poetry new</tt> command will
create the project directory and a sensible starting layout.</p>
<p>I don't really want to go quite that far (although actually it's a good idea
in general), so I shall just use <tt class="docutils literal">poetry init</tt> to get started. This takes
the user through some questions to generate the <tt class="docutils literal">pyproject.toml</tt> file that
poetry requires:</p>
<pre class="code bash literal-block">
tibs ~/temp$ poetry init

This <span class="name builtin">command</span> will guide you through creating your pyproject.toml config.

Package name <span class="operator">[</span>temp<span class="operator">]</span>:
Version <span class="operator">[</span><span class="literal number">0</span>.1.0<span class="operator">]</span>:
Description <span class="operator">[]</span>:
Author <span class="operator">[</span>Tibs &lt;tibs&#64;tonyibbs.co.uk&gt;, n to skip<span class="operator">]</span>:
License <span class="operator">[]</span>:  MIT
Compatible Python versions <span class="operator">[</span>^3.7<span class="operator">]</span>:

Would you like to define your main dependencies interactively? <span class="operator">(</span>yes/no<span class="operator">)</span> <span class="operator">[</span>yes<span class="operator">]</span> no
Would you like to define your dev dependencies <span class="operator">(</span>require-dev<span class="operator">)</span> interactively <span class="operator">(</span>yes/no<span class="operator">)</span> <span class="operator">[</span>yes<span class="operator">]</span> no
Generated file

<span class="operator">[</span>tool.poetry<span class="operator">]</span>
<span class="name variable">name</span> <span class="operator">=</span> <span class="literal string double">&quot;temp&quot;</span>
<span class="name variable">version</span> <span class="operator">=</span> <span class="literal string double">&quot;0.1.0&quot;</span>
<span class="name variable">description</span> <span class="operator">=</span> <span class="literal string double">&quot;&quot;</span>
<span class="name variable">authors</span> <span class="operator">=</span> <span class="operator">[</span><span class="literal string double">&quot;Tibs &lt;tibs&#64;tonyibbs.co.uk&gt;&quot;</span><span class="operator">]</span>
<span class="name variable">license</span> <span class="operator">=</span> <span class="literal string double">&quot;MIT&quot;</span>

<span class="operator">[</span>tool.poetry.dependencies<span class="operator">]</span>
<span class="name variable">python</span> <span class="operator">=</span> <span class="literal string double">&quot;^3.7&quot;</span>

<span class="operator">[</span>tool.poetry.dev-dependencies<span class="operator">]</span>

<span class="operator">[</span>build-system<span class="operator">]</span>
<span class="name variable">requires</span> <span class="operator">=</span> <span class="operator">[</span><span class="literal string double">&quot;poetry&gt;=0.12&quot;</span><span class="operator">]</span>
build-backend <span class="operator">=</span> <span class="literal string double">&quot;poetry.masonry.api&quot;</span>


Do you confirm generation? <span class="operator">(</span>yes/no<span class="operator">)</span> <span class="operator">[</span>yes<span class="operator">]</span>
</pre>
<p>and the resultant file is indeed as described:</p>
<pre class="literal-block">
[tool.poetry]
name = &quot;temp&quot;
version = &quot;0.1.0&quot;
description = &quot;&quot;
authors = [&quot;Tibs &lt;tibs&#64;tonyibbs.co.uk&gt;&quot;]
license = &quot;MIT&quot;

[tool.poetry.dependencies]
python = &quot;^3.7&quot;

[tool.poetry.dev-dependencies]

[build-system]
requires = [&quot;poetry&gt;=0.12&quot;]
build-backend = &quot;poetry.masonry.api&quot;
</pre>
<p>As you can see, that files specifies what version of Python I need (I think
it's just a regular expression indicating any Python 3.7)</p>
<p>So now I can create my virtual environment:</p>
<pre class="code bash literal-block">
tibs ~/temp$ poetry install
Creating virtualenv temp-PD0d5gaI-py3.7 in /Users/tibs/Library/Caches/pypoetry/virtualenvs
Updating dependencies
Resolving dependencies... <span class="operator">(</span><span class="literal number">0</span>.1s<span class="operator">)</span>

Writing lock file

No dependencies to install or update
</pre>
<p>Where the virtual environment directory goes is dependent on the operating
system. On a Mac, <tt class="docutils literal">~/Library/Caches</tt> is a fairly traditional sort of place.</p>
<p>And if we look there:</p>
<pre class="literal-block">
.. code:: bash
</pre>
<blockquote>
tibs ~/temp$ ls -aF /Users/tibs/Library/Caches/pypoetry/virtualenvs/temp-PD0d5gaI-py3.7/
./          ../         bin/        include/    lib/        pyvenv.cfg</blockquote>
<p>which tells us we've created a (modern) <tt class="docutils literal">venv</tt> virtual environment. The name
of the virtual environment includes our starting directory name, a hash, and
the version of Python.</p>
<p>Meanwhile, in the current directory, we have:</p>
<pre class="code bash literal-block">
tibs ~/temp$ ls -F
poetry.lock     pyproject.toml
</pre>
<p>The <tt class="docutils literal">pyproject.toml</tt> hasn't changed, and the <tt class="docutils literal">poetry.lock</tt> contains:</p>
<pre class="literal-block">
package = []

[metadata]
content-hash = &quot;669741988c507fb04697bdb0c9077fa1b2342c356df6ae6c96baa3119a96a9ea&quot;
python-versions = &quot;^3.7&quot;

[metadata.files]
</pre>
<p>We get into our virtual environment by starting a new shell using it:</p>
<pre class="code bash literal-block">
tibs ~/temp$ poetry shell
Spawning shell within /Users/tibs/Library/Caches/pypoetry/virtualenvs/temp-PD0d5gaI-py3.7
Welcome to fish, the friendly interactive shell
tibs ~/temp$ <span class="name builtin">source</span> /Users/tibs/Library/Caches/pypoetry/virtualenvs/temp-PD0d5gaI-py3.7/bin/activate.fish
<span class="operator">(</span>temp-PD0d5gaI-py3.7<span class="operator">)</span> tibs ~/temp$
</pre>
<p>which should look fairly familiar. And that means we get out by using <tt class="docutils literal">exit</tt>
or <tt class="docutils literal"><span class="pre">CTRL-D</span></tt> to leave the subshell.</p>
<p>To add a new package, we use <tt class="docutils literal">poetry add</tt>:</p>
<pre class="code bash literal-block">
<span class="operator">(</span>temp-PD0d5gaI-py3.7<span class="operator">)</span> tibs ~/temp$ poetry add requests                                  I
Using version ^2.22.0 <span class="keyword">for</span> requests

Updating dependencies
Resolving dependencies... <span class="operator">(</span><span class="literal number">1</span>.0s<span class="operator">)</span>

Writing lock file


Package operations: <span class="literal number">0</span> installs, <span class="literal number">5</span> updates, <span class="literal number">0</span> removals

  - Updating certifi <span class="operator">(</span><span class="literal number">2019</span>.11.28 /usr/local/Cellar/poetry/1.0.3/libexec/vendor/lib/python3.7/site-packages -&gt; <span class="literal number">2019</span>.11.28<span class="operator">)</span>
  - Updating chardet <span class="operator">(</span><span class="literal number">3</span>.0.4 /usr/local/Cellar/poetry/1.0.3/libexec/vendor/lib/python3.7/site-packages -&gt; <span class="literal number">3</span>.0.4<span class="operator">)</span>
  - Updating idna <span class="operator">(</span><span class="literal number">2</span>.8 /usr/local/Cellar/poetry/1.0.3/libexec/vendor/lib/python3.7/site-packages -&gt; <span class="literal number">2</span>.8<span class="operator">)</span>
  - Updating urllib3 <span class="operator">(</span><span class="literal number">1</span>.25.8 /usr/local/Cellar/poetry/1.0.3/libexec/vendor/lib/python3.7/site-packages -&gt; <span class="literal number">1</span>.25.8<span class="operator">)</span>
  - Updating requests <span class="operator">(</span><span class="literal number">2</span>.22.0 /usr/local/Cellar/poetry/1.0.3/libexec/vendor/lib/python3.7/site-packages -&gt; <span class="literal number">2</span>.22.0<span class="operator">)</span>
</pre>
<p>Now I can import <tt class="docutils literal">requests</tt>.</p>
<p>The <tt class="docutils literal">pyproject.toml</tt> now lists <tt class="docutils literal">requests</tt>:</p>
<pre class="literal-block">
[tool.poetry]
name = &quot;temp&quot;
version = &quot;0.1.0&quot;
description = &quot;&quot;
authors = [&quot;Tibs &lt;tibs&#64;tonyibbs.co.uk&gt;&quot;]
license = &quot;MIT&quot;

[tool.poetry.dependencies]
python = &quot;^3.7&quot;
requests = &quot;^2.22.0&quot;

[tool.poetry.dev-dependencies]

[build-system]
requires = [&quot;poetry&gt;=0.12&quot;]
build-backend = &quot;poetry.masonry.api&quot;
</pre>
<p>and the <tt class="docutils literal">poetry.lock</tt> also specifies the dependencies for <tt class="docutils literal">requests</tt>:</p>
<pre class="literal-block">
[[package]]
category = &quot;main&quot;
description = &quot;Python package for providing Mozilla's CA Bundle.&quot;
name = &quot;certifi&quot;
optional = false
python-versions = &quot;*&quot;
version = &quot;2019.11.28&quot;

[[package]]
category = &quot;main&quot;
description = &quot;Universal encoding detector for Python 2 and 3&quot;
name = &quot;chardet&quot;
optional = false
python-versions = &quot;*&quot;
version = &quot;3.0.4&quot;

[[package]]
category = &quot;main&quot;
description = &quot;Internationalized Domain Names in Applications (IDNA)&quot;
name = &quot;idna&quot;
optional = false
python-versions = &quot;&gt;=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*&quot;
version = &quot;2.8&quot;

[[package]]
category = &quot;main&quot;
description = &quot;Python HTTP for Humans.&quot;
name = &quot;requests&quot;
optional = false
python-versions = &quot;&gt;=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*&quot;
version = &quot;2.22.0&quot;

[package.dependencies]
certifi = &quot;&gt;=2017.4.17&quot;
chardet = &quot;&gt;=3.0.2,&lt;3.1.0&quot;
idna = &quot;&gt;=2.5,&lt;2.9&quot;
urllib3 = &quot;&gt;=1.21.1,&lt;1.25.0 || &gt;1.25.0,&lt;1.25.1 || &gt;1.25.1,&lt;1.26&quot;

[package.extras]
security = [&quot;pyOpenSSL (&gt;=0.14)&quot;, &quot;cryptography (&gt;=1.3.4)&quot;, &quot;idna (&gt;=2.0.0)&quot;]
socks = [&quot;PySocks (&gt;=1.5.6,&lt;1.5.7 || &gt;1.5.7)&quot;, &quot;win-inet-pton&quot;]

[[package]]
category = &quot;main&quot;
description = &quot;HTTP library with thread-safe connection pooling, file post, and more.&quot;
name = &quot;urllib3&quot;
optional = false
python-versions = &quot;&gt;=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*, &lt;4&quot;
version = &quot;1.25.8&quot;

[package.extras]
brotli = [&quot;brotlipy (&gt;=0.6.0)&quot;]
secure = [&quot;pyOpenSSL (&gt;=0.14)&quot;, &quot;cryptography (&gt;=1.3.4)&quot;, &quot;idna (&gt;=2.0.0)&quot;, &quot;certifi&quot;, &quot;ipaddress&quot;]
socks = [&quot;PySocks (&gt;=1.5.6,&lt;1.5.7 || &gt;1.5.7,&lt;2.0)&quot;]

[metadata]
content-hash = &quot;c68b73b166d0ac88096f038dc3b8ab730dc56bdbea7d02ec26a3187fc89ec774&quot;
python-versions = &quot;^3.7&quot;

[metadata.files]
certifi = [
    {file = &quot;certifi-2019.11.28-py2.py3-none-any.whl&quot;, hash = &quot;sha256:017c25db2a153ce562900032d5bc68e9f191e44e9a0f762f373977de9df1fbb3&quot;},
    {file = &quot;certifi-2019.11.28.tar.gz&quot;, hash = &quot;sha256:25b64c7da4cd7479594d035c08c2d809eb4aab3a26e5a990ea98cc450c320f1f&quot;},
]
chardet = [
    {file = &quot;chardet-3.0.4-py2.py3-none-any.whl&quot;, hash = &quot;sha256:fc323ffcaeaed0e0a02bf4d117757b98aed530d9ed4531e3e15460124c106691&quot;},
    {file = &quot;chardet-3.0.4.tar.gz&quot;, hash = &quot;sha256:84ab92ed1c4d4f16916e05906b6b75a6c0fb5db821cc65e70cbd64a3e2a5eaae&quot;},
]
idna = [
    {file = &quot;idna-2.8-py2.py3-none-any.whl&quot;, hash = &quot;sha256:ea8b7f6188e6fa117537c3df7da9fc686d485087abf6ac197f9c46432f7e4a3c&quot;},
    {file = &quot;idna-2.8.tar.gz&quot;, hash = &quot;sha256:c357b3f628cf53ae2c4c05627ecc484553142ca23264e593d327bcde5e9c3407&quot;},
]
requests = [
    {file = &quot;requests-2.22.0-py2.py3-none-any.whl&quot;, hash = &quot;sha256:9cf5292fcd0f598c671cfc1e0d7d1a7f13bb8085e9a590f48c010551dc6c4b31&quot;},
    {file = &quot;requests-2.22.0.tar.gz&quot;, hash = &quot;sha256:11e007a8a2aa0323f5a921e9e6a2d7e4e67d9877e85773fba9ba6419025cbeb4&quot;},
]
urllib3 = [
    {file = &quot;urllib3-1.25.8-py2.py3-none-any.whl&quot;, hash = &quot;sha256:2f3db8b19923a873b3e5256dc9c2dedfa883e33d87c690d9c7913e1f40673cdc&quot;},
    {file = &quot;urllib3-1.25.8.tar.gz&quot;, hash = &quot;sha256:87716c2d2a7121198ebcb7ce7cccf6ce5e9ba539041cfbaeecfb641dc0bf6acc&quot;},
]
</pre>
<p>Notes:</p>
<ul class="simple">
<li><a class="reference external" href="https://python-poetry.org/">poetry</a> is somewhat similar to <a class="reference external" href="https://pipenv.readthedocs.io/">pipenv</a>, but its overall aims are not quite
the same - in particular:<ul>
<li>it aims to help with more of the steps of devloping a new package (for
instance, <tt class="docutils literal">poetry publish</tt> will publish to <a class="reference external" href="https://pypi.org/">PyPi</a></li>
<li>the project maintainers seem to want to track the future of &quot;official&quot;
Python package management, which is in part why the configuration files
take the form they do.</li>
</ul>
</li>
<li><a class="reference external" href="https://python-poetry.org/">poetry</a> is supported on Windows 10, but I'm not sure if only in Powershell.</li>
<li><a class="reference external" href="https://github.com/toml-lang/toml">TOML</a> (according to its home page) &quot;aims to be a minimal configuration file
format that's easy to read due to obvious semantics. TOML is designed to map
unambiguously to a hash table. TOML should be easy to parse into data
structures in a wide variety of languages.&quot;</li>
<li>The PEPs relating to the future of Python packaging are also using the
<tt class="docutils literal">pyproject.toml</tt> file, so poetry is trying to build on the same
infrastructure.</li>
</ul>
</div>
<div class="section" id="conda">
<h2><a class="toc-backref" href="#id42">conda</a></h2>
<p><a class="reference external" href="https://conda.io/">conda</a> comes out of the <a class="reference external" href="https://anaconda.org/">Anaconda</a> project, which started as a means of
providing easy installation of scientific/numeric Python on Windows. It's now
a lot more than that, but still aimed at the scientific / big data worlds.</p>
<p>I don't know much about <a class="reference external" href="https://conda.io/">conda</a>, because I've never used it.</p>
<ul class="simple">
<li>if you've got anaconda, you're already using this - so just keep doing so</li>
<li>support for many different languages</li>
<li>there is <a class="reference external" href="https://conda.io/en/latest/miniconda.html">miniconda</a> which is <tt class="docutils literal">conda</tt> without <em>all</em> of the packages - this
is closer to just using <tt class="docutils literal">pip</tt>.</li>
</ul>
</div>
<div class="section" id="enthought-deployment-manager">
<h2><a class="toc-backref" href="#id43">Enthought Deployment Manager</a></h2>
<p>If you're using the <a class="reference external" href="https://docs.enthought.com/ets/">Enthought Tool Suite</a>, then you will have <a class="reference external" href="https://www.enthought.com/enthought-deployment-manager/">edm</a> (the
Enthought Deployment Manager) available, which also provides similar
capabilities.</p>
</div>
</div>
<div class="section" id="ides">
<h1><a class="toc-backref" href="#id44">IDEs</a></h1>
<div class="section" id="vs-code">
<h2><a class="toc-backref" href="#id45">VS Code</a></h2>
<p><a class="reference external" href="https://code.visualstudio.com/">VS Code</a> (Visual Studio Code) supports Python virtual environments.</p>
<p>If you are editing a Python file, the Python interpreter being used is shown
at the bottom left of the screen.</p>
<p>If you click on that, then you will be shown a list of available Python
interpreters, and that will include those provided by your virtual
environments.</p>
<p><a class="reference external" href="https://code.visualstudio.com/docs/python/environments">Using Python environments in VS Code</a> explains how it decides where to look,
and also how to specify a Python interpreter that it cannot automatically
find.</p>
<p>If you are working with a VS Code &quot;workspace&quot;, then it will automatically find a
<tt class="docutils literal">.venv</tt> directory in that workspace.</p>
<p>Also, VS Code understands the locations that <a class="reference external" href="https://virtualenvwrapper.readthedocs.io">virtualenvwrapper</a> and <a class="reference external" href="https://pipenv.readthedocs.io/">pipenv</a>
use to store virtual environments, and its simple to use with <a class="reference external" href="https://python-poetry.org/">poetry</a> as well
(see the second article in <a class="reference external" href="https://www.pythoncheatsheet.org/blog/python-projects-with-poetry-and-vscode-part-1/">Python projects with Poetry and VSCode</a>).</p>
</div>
<div class="section" id="pycharm">
<h2><a class="toc-backref" href="#id46">PyCharm</a></h2>
<p><a class="reference external" href="https://www.jetbrains.com/pycharm/">PyCharm</a>: always thinks in terms of &quot;projects&quot;.</p>
<p><a class="reference external" href="https://www.jetbrains.com/help/pycharm/creating-virtual-environment.html">Configure a virtual environment</a> explains how to use and create virtual
environments in PyCharm, and <a class="reference external" href="https://www.jetbrains.com/help/pycharm/conda-support-creating-conda-virtual-environment.html">Conda virtual environment</a> explains how to use
<a class="reference external" href="https://conda.io/">conda</a> virtual environments.</p>
<p>When setting up the Python interpreter for use in a PyCharm project, you need
to specify the full path to the Python executable. So, for instance:</p>
<pre class="literal-block">
~/tibs/temp/venv/bin/python3
</pre>
</div>
<div class="section" id="atom">
<h2><a class="toc-backref" href="#id47">Atom</a></h2>
<p>There appear to be multiple packages that support virtual environments
for Python in <a class="reference external" href="https://atom.io/">atom</a>. I'm assuimg that if you use atom you know your way around
the package system.</p>
</div>
<div class="section" id="jupyter-notebook">
<h2><a class="toc-backref" href="#id48">Jupyter notebook</a></h2>
<p><a class="reference external" href="https://jupyter.org/">Jupyter</a> notebook isn't really an IDE, but virtual environments are still
relevant when using it.</p>
<p>The simplest thing to do is to create your virtual environment, then install
jupyter notebook within it. When you run that jupyter notebook, it will
automatically use the Python it was installed for.</p>
<p>For instance:</p>
<pre class="literal-block">
$ source .venv/bin/activate
$ pip install jupyter
$ jupyter notebook
</pre>
<p>It <em>is</em> possible to run multiple Python &quot;backends&quot; for Jupyter notebook, but
that's a bit beyond this document.</p>
</div>
</div>
<div class="section" id="awkward-questions">
<h1><a class="toc-backref" href="#id49">Awkward questions</a></h1>
<div class="section" id="what-happens-if-i-activate-a-virtual-environment-while-i-ve-got-one-activated">
<h2><a class="toc-backref" href="#id50">What happens if I activate a virtual environment while I've got one activated?</a></h2>
<p>The new activation will &quot;take over&quot;.</p>
<p>In particular, the old virtual environment binary directory is removed from
the PATH and the new one is added instead.</p>
<p>However, I don't know if anything <em>promises</em> that this will work, so it's
perhaps best not to rely on it.</p>
</div>
<div class="section" id="can-i-deliberately-create-a-virtual-environment-that-depends-on-another">
<h2><a class="toc-backref" href="#id51">Can I (deliberately) create a virtual environment that depends on another?</a></h2>
<p>Yes. Simply do <tt class="docutils literal">python <span class="pre">-m</span> venv &lt;name&gt;</tt> inside an already activated virtual
environment.</p>
<p>If you inspect the <tt class="docutils literal">bin/python</tt> entry (on unix, at least) you will see it
links to the Python from the earlier virtual environment.</p>
<p><em>Why</em> you might want to do that, and how useful it might be, is
another discussion.</p>
</div>
<div class="section" id="how-do-i-stop-pip-from-installing-outside-a-virtual-environment">
<h2><a class="toc-backref" href="#id52">How do I stop <tt class="docutils literal">pip</tt> from installing outside a virtual environment?</a></h2>
<p>It's not very well documented, but the simplest way to do this is to set the
environment variable:</p>
<pre class="literal-block">
PIP_REQUIRE_VIRTUALENV=true
</pre>
<p>For instance, in your <tt class="docutils literal">.bashrc</tt> you would add:</p>
<pre class="literal-block">
export PIP_REQUIRE_VIRTUALENV=true
</pre>
<p>and that would then take effect when you open a new shell.</p>
<p>When that is set, any attempt to use <tt class="docutils literal">pip install &lt;something&gt;</tt> outside a
virtual environment will give the error message:</p>
<pre class="literal-block">
ERROR: Could not find an activated virtualenv (required).
</pre>
</div>
<div class="section" id="do-i-need-to-activate-the-virtual-environment">
<h2><a class="toc-backref" href="#id53">Do I <em>need</em> to activate the virtual environment?</a></h2>
<p>Well, actually, no. It just makes things more convenient. If you run the
Python in the virtual environment <tt class="docutils literal">bin</tt> directory (<tt class="docutils literal">Scripts</tt> for Wndows)
explicitly, then that Python will &quot;look around itself&quot; and use the virtual
environment.</p>
<p>So:</p>
<pre class="code bash literal-block">
<span class="operator">(</span>venv<span class="operator">)</span> tibs ~/temp$ deactivate
tibs ~/temp$ venv/bin/python
Python <span class="literal number">3</span>.7.6 <span class="operator">(</span>default, Jan <span class="literal number">28</span> <span class="literal number">2020</span>, <span class="literal number">22</span>:16:20<span class="operator">)</span>
<span class="operator">[</span>Clang <span class="literal number">11</span>.0.0 <span class="operator">(</span>clang-1100.0.33.16<span class="operator">)]</span> on darwin
Type <span class="literal string double">&quot;help&quot;</span>, <span class="literal string double">&quot;copyright&quot;</span>, <span class="literal string double">&quot;credits&quot;</span> or <span class="literal string double">&quot;license&quot;</span> <span class="keyword">for</span> more information.
&gt;&gt;&gt; import requests
&gt;&gt;&gt; exit<span class="operator">()</span>
</pre>
<p>That <em>also</em> means that if you install a Python program to the virtual
environment <tt class="docutils literal">bin</tt> directory, and run it directly (using its full path) then
it too will know what environment to use, without your needing to activate the
virtual environment.</p>
<p>For example:</p>
<pre class="code bash literal-block">
tibs ~/temp$ python3 -m venv pydep
tibs ~/temp$ <span class="name builtin">source</span> pydep/bin/activate.fish
<span class="operator">(</span>pydep<span class="operator">)</span> tibs ~/temp$ pip install pipdeptree
Collecting pipdeptree
  Using cached https://files.pythonhosted.org/packages/12/64/26c7df3ad833cd6e8b9735c5958b25d6aef1617c915b2731baedfbeee712/pipdeptree-0.13.2-py3-none-any.whl
Requirement already satisfied: pip&gt;<span class="operator">=</span><span class="literal number">6</span>.0.0 in ./pydep/lib/python3.7/site-packages <span class="operator">(</span>from pipdeptree<span class="operator">)</span> <span class="operator">(</span><span class="literal number">19</span>.2.3<span class="operator">)</span>
Installing collected packages: pipdeptree
Successfully installed pipdeptree-0.13.2
<span class="operator">(</span>pydep<span class="operator">)</span> tibs ~/temp$ ls pydep/bin/pipdeptree
pydep/bin/pipdeptree
<span class="operator">(</span>pydep<span class="operator">)</span> tibs ~/temp$ deactivate
tibs ~/temp$ pydep/bin/pipdeptree --version
<span class="literal number">0</span>.13.2
</pre>
</div>
<div class="section" id="what-happens-when-i-upgrade-python">
<h2><a class="toc-backref" href="#id54">What happens when I upgrade Python?</a></h2>
<p>That is, if the older Python &quot;disappears&quot; (as will generally happen with a
<tt class="docutils literal">homebrew</tt> upgrade on a Mac, for instance), do my virtual environments just
stop working?</p>
<p>Well, generally, yes, but...</p>
<p>If it's a basic virtual environment, then yes, it will stop working, and the
best / simplest thing to do is just to recreate it by hand.</p>
<pre class="code bash literal-block">
tibs ~/temp$ brew install python&#64;3.8    <span class="comment single"># installs it into /usr/local/opt/python&#64;3.8
</span>tibs ~/temp$ <span class="name builtin">set</span> -g fish_user_paths <span class="literal string double">&quot;/usr/local/opt/python&#64;3.8/bin&quot;</span> <span class="name variable">$fish_user_paths</span><span class="error">'</span>
</pre>
<p>and now Python3.8 is what I get (in that shell) when I type <tt class="docutils literal">python3</tt></p>
<p>If it's a pipenv or poetry virtual environment, then:</p>
<div class="section" id="using-pipenv">
<h3><a class="toc-backref" href="#id55">Using pipenv</a></h3>
<p>Remember that our <tt class="docutils literal">Pipfile</tt> file looks something like:</p>
<pre class="literal-block">
[[source]]
name = &quot;pypi&quot;
url = &quot;https://pypi.org/simple&quot;
verify_ssl = true

[dev-packages]

[packages]
requests = &quot;*&quot;

[requires]
python_version = &quot;3.7&quot;
</pre>
<p>I can edit the <tt class="docutils literal">Pipfile</tt> to change the requested version of Python, and
then:</p>
<pre class="code bash literal-block">
tibs ~/temp$ pipenv --rm
Removing virtualenv <span class="operator">(</span>/Users/tibs/.local/share/virtualenvs/temp--1EXmzEU<span class="operator">)</span>…
</pre>
<pre class="code bash literal-block">
tibs ~/temp$ pipenv shell
Creating a virtualenv <span class="keyword">for</span> this project…
Pipfile: /Users/tibs/temp/Pipfile
Using /usr/local/opt/python&#64;3.8/bin/python3 <span class="operator">(</span><span class="literal number">3</span>.8.1<span class="operator">)</span> to create virtualenv…
? Creating virtual environment...Already using interpreter /usr/local/opt/python&#64;3.8/bin/python3.8
Using base prefix <span class="literal string single">'/usr/local/Cellar/python&#64;3.8/3.8.1/Frameworks/Python.framework/Versions/3.8'</span>
New python executable in /Users/tibs/.local/share/virtualenvs/temp--1EXmzEU/bin/python3.8
Also creating executable in /Users/tibs/.local/share/virtualenvs/temp--1EXmzEU/bin/python
Installing setuptools, pip, wheel...
<span class="keyword">done</span>.
Running virtualenv with interpreter /usr/local/opt/python&#64;3.8/bin/python3

? Successfully created virtual environment!
Virtualenv location: /Users/tibs/.local/share/virtualenvs/temp--1EXmzEU
Launching subshell in virtual environment…
Welcome to fish, the friendly interactive shell
tibs ~/temp$  <span class="name builtin">source</span> /Users/tibs/.local/share/virtualenvs/temp--1EXmzEU/bin/activate.fish
<span class="operator">(</span>temp<span class="operator">)</span> tibs ~/temp$
</pre>
<p>and now <tt class="docutils literal">python</tt> is 3.8.</p>
</div>
<div class="section" id="using-poetry">
<h3><a class="toc-backref" href="#id56">Using poetry</a></h3>
<p>Remember that our <tt class="docutils literal">pyproject.toml</tt> file looks like:</p>
<pre class="literal-block">
[tool.poetry]
name = &quot;temp&quot;
version = &quot;0.1.0&quot;
description = &quot;&quot;
authors = [&quot;Tibs &lt;tibs&#64;tonyibbs.co.uk&gt;&quot;]
license = &quot;MIT&quot;

[tool.poetry.dependencies]
python = &quot;^3.7&quot;
requests = &quot;^2.22.0&quot;

[tool.poetry.dev-dependencies]

[build-system]
requires = [&quot;poetry&gt;=0.12&quot;]
build-backend = &quot;poetry.masonry.api&quot;
</pre>
<p>I can edit the <tt class="docutils literal">pyproject.toml</tt> file to change the requested version of
Python, and then:</p>
<pre class="code bash literal-block">
tibs ~/temp$ poetry env remove python3.7
Deleted virtualenv: /Users/tibs/Library/Caches/pypoetry/virtualenvs/temp-PD0d5gaI-py3.7
</pre>
<pre class="code bash literal-block">
tibs ~/temp$ poetry shell
The currently activated Python version <span class="literal number">3</span>.7.6 is not supported by the project <span class="operator">(</span>^3.8<span class="operator">)</span>.
Trying to find and use a compatible version.
Using python3 <span class="operator">(</span><span class="literal number">3</span>.8.1<span class="operator">)</span>
Creating virtualenv temp-PD0d5gaI-py3.8 in /Users/tibs/Library/Caches/pypoetry/virtualenvs
Spawning shell within /Users/tibs/Library/Caches/pypoetry/virtualenvs/temp-PD0d5gaI-py3.8
Welcome to fish, the friendly interactive shell
tibs ~/temp$ <span class="name builtin">source</span> /Users/tibs/Library/Caches/pypoetry/virtualenvs/temp-PD0d5gaI-py3.8/bin/activate.fish
</pre>
<p>and now <tt class="docutils literal">python</tt> is 3.8.</p>
</div>
<div class="section" id="also">
<h3><a class="toc-backref" href="#id57">Also...</a></h3>
<p>(Also, if this is a problem you keep having, consider using <a class="reference external" href="https://github.com/pyenv/pyenv">pyenv</a>, which is
briefly discussed under <a class="reference internal" href="#multiple-pythons">Multiple Pythons</a> below.</p>
</div>
</div>
<div class="section" id="what-about-an-existing-requirements-txt">
<h2><a class="toc-backref" href="#id58">What about an existing requirements.txt?</a></h2>
<p>If you get the source code for a package, it may come with a requirements.txt
file (probably output using <tt class="docutils literal">pip freeze</tt>) that you want to use to setup
your virtual environment.</p>
<p>If you're just using a normal virtual environment, you can just install the
packages from that file using <tt class="docutils literal">pip install <span class="pre">-r</span> requirements.txt</tt></p>
<p>If you're using pipenv, then when you do <tt class="docutils literal">pipenv install</tt> it will notice
that there is a <tt class="docutils literal">requirements.txt</tt> file (but no <tt class="docutils literal">Pipfile</tt>) and read one to
create the other. Or you can be explicit: <tt class="docutils literal">pipenv install <span class="pre">-r</span> requirements.txt</tt>.</p>
<p>If you're using poetry, then you currently need to add the contents of the
<tt class="docutils literal">requirements.txt</tt> file to the <tt class="docutils literal">pyproject.toml</tt> file by hand (in the
<tt class="docutils literal">[tool.poetry.dependencies]</tt> or <tt class="docutils literal"><span class="pre">[tool.poetry.dev-dependencies]</span></tt> sections,
as appropriate).</p>
<p>Poetry <a class="reference external" href="https://github.com/python-poetry/poetry/issues/46">issue 46</a> talks about this, and some workarounds.</p>
</div>
</div>
<div class="section" id="the-venv-directory-and-version-control-systems">
<h1><a class="toc-backref" href="#id59">The venv directory and version control systems</a></h1>
<p>Broadly, don't commit the <tt class="docutils literal">venv</tt> directory to your version control
system. It doesn't contain anything portable (by definition).</p>
<p>If you're using git, then you may want to add a rule to your <tt class="docutils literal">.gitignore</tt>
file - for instance:</p>
<pre class="literal-block">
/venv/
</pre>
<p>(altering to match the actual name of the directory).</p>
<blockquote>
<p><strong>Is the next bit good advice?</strong></p>
<p><em>However</em> if your git repository is shared with anyone else, you might not
want to assume that everyone uses the same venv directory name. In that case,
it may be to put it into a top-level <tt class="docutils literal">.gitignore</tt> (e.g., <tt class="docutils literal"><span class="pre">~/.gitignore</span></tt>)
instead.</p>
</blockquote>
</div>
<div class="section" id="the-system-site-packages-switch">
<h1><a class="toc-backref" href="#id60">The <tt class="docutils literal"><span class="pre">--system-site-packages</span></tt> switch</a></h1>
<p>Normally, when I create a new virtual environment, it starts without anything
installed (except <tt class="docutils literal">pip</tt> and other basic infrastructure). So if the Python I
used to create the virtual environment (the <tt class="docutils literal">python3</tt> in <tt class="docutils literal">python3 <span class="pre">-m</span>
venv</tt>) had (for instance) <tt class="docutils literal">docutils</tt> installed, the new virtual environment
would not.</p>
<p>The <tt class="docutils literal"><span class="pre">--system-site-packages</span></tt> switch lets the new virtual environment &quot;see&quot;
the packages in the original Python.</p>
<pre class="code bash literal-block">
tibs ~/temp$ python3 -m venv secondary
tibs ~/temp$ <span class="name builtin">source</span> secondary/bin/activate.fish
<span class="operator">(</span>secondary<span class="operator">)</span> tibs ~/temp$ python
Python <span class="literal number">3</span>.7.6 <span class="operator">(</span>default, Jan <span class="literal number">28</span> <span class="literal number">2020</span>, <span class="literal number">22</span>:16:20<span class="operator">)</span>
<span class="operator">[</span>Clang <span class="literal number">11</span>.0.0 <span class="operator">(</span>clang-1100.0.33.16<span class="operator">)]</span> on darwin
Type <span class="literal string double">&quot;help&quot;</span>, <span class="literal string double">&quot;copyright&quot;</span>, <span class="literal string double">&quot;credits&quot;</span> or <span class="literal string double">&quot;license&quot;</span> <span class="keyword">for</span> more information.
&gt;&gt;&gt; import docutils
Traceback <span class="operator">(</span>most recent call last<span class="operator">)</span>:
  File <span class="literal string double">&quot;&lt;stdin&gt;&quot;</span>, line <span class="literal number">1</span>, in &lt;module&gt;
ModuleNotFoundError: No module named <span class="literal string single">'docutils'</span>
&gt;&gt;&gt; exit<span class="operator">()</span>
<span class="operator">(</span>secondary<span class="operator">)</span> tibs ~/temp$ deactivate
</pre>
<pre class="code bash literal-block">
tibs ~/temp$ python3 -m venv tertiary --system-site-packages
tibs ~/temp$ cat tertiary/pyvenv.cfg
<span class="name variable">home</span> <span class="operator">=</span> /usr/local/bin
include-system-site-packages <span class="operator">=</span> <span class="name builtin">true</span>
<span class="name variable">version</span> <span class="operator">=</span> <span class="literal number">3</span>.7.6
tibs ~/temp$ <span class="name builtin">source</span> tertiary/bin/activate.fish
<span class="operator">(</span>tertiary<span class="operator">)</span> tibs ~/temp$ python
Python <span class="literal number">3</span>.7.6 <span class="operator">(</span>default, Jan <span class="literal number">28</span> <span class="literal number">2020</span>, <span class="literal number">22</span>:16:20<span class="operator">)</span>
<span class="operator">[</span>Clang <span class="literal number">11</span>.0.0 <span class="operator">(</span>clang-1100.0.33.16<span class="operator">)]</span> on darwin
Type <span class="literal string double">&quot;help&quot;</span>, <span class="literal string double">&quot;copyright&quot;</span>, <span class="literal string double">&quot;credits&quot;</span> or <span class="literal string double">&quot;license&quot;</span> <span class="keyword">for</span> more information.
&gt;&gt;&gt; import docutils
&gt;&gt;&gt; exit<span class="operator">()</span>
</pre>
</div>
<div class="section" id="multiple-pythons">
<h1><a class="toc-backref" href="#id61">Multiple Pythons</a></h1>
<p>Sometimes you need more than one version of Python - for instance, to test
that a new version of Python is still compatible with existing code.</p>
<p>System package managers cannot always help with this - they typically only
support a subset of the possible versions (homebrew on the Mac supports one
Python per major version), and it can take some time for a new version to be
provided (particularly a problem with some enterprise linuxes).</p>
<p>The solution is to use <a class="reference external" href="https://github.com/pyenv/pyenv">pyenv</a>, which makes it easy to build Python at
different versions.</p>
<p>(For Windows, you may want to look at <a class="reference external" href="https://github.com/pyenv-win/pyenv-win">pyenv-win</a> instead)</p>
<p>Remember that this is <em>not</em> the same as virtual environments, but is
complementary.</p>
</div>
<div class="section" id="other-tools">
<h1><a class="toc-backref" href="#id62">Other tools</a></h1>
<p>These are lots of other tools out there for making it easier (in some sense)
to manage virtual environments. Four (that I have not used!) are:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/purajit/venv_manager">venv_manager</a> is intended for bash and zsh users, and detects and activates
virtual environments as you <tt class="docutils literal">cd</tt> into the directories that contain them
(by default it looks for <tt class="docutils literal">.venv</tt> directories).</li>
<li><a class="reference external" href="https://direnv.net/">direnv</a> is a more powerful tool that takes actions when you <tt class="docutils literal">cd</tt> into a
directory, and it too can be used to activate virtual environments. I
confess that its documentation intimidates me.</li>
<li><a class="reference external" href="https://github.com/replit/upm">upm</a> is a &quot;universal package manager&quot;, which is meant to act as a consistent
front end (command line tool) for various different programming
languages. For Python it wraps <a class="reference external" href="https://python-poetry.org/">poetry</a>.</li>
<li><a class="reference external" href="https://dephell.readthedocs.io/">DepHell</a> is a project management tool for Python that is meant to be an
all-in-one solution that can (for instance) work with pip, pipenv and
poetry. If you're needing to convert beween tools, or work with multiple
tools, it may be a good solution.</li>
</ul>
</div>
<div class="section" id="an-example-of-using-venv-on-windows-10">
<h1><a class="toc-backref" href="#id63">An example of using <tt class="docutils literal">venv</tt> on Windows 10</a></h1>
<!-- Super secure information(!)

* password: sausages
* first pet's name: first
* city where I was born: city
* first school: school

And yes, those are stupid, and no, I don't use them anywhere else (!),
which is why I'm happy putting them on github! -->
<p>I installed Windows 10 in a virtual machine on my Mac.</p>
<p>The version of Windows I got as a trial version was not recent enough to
prompt me to get Python when I typed <tt class="docutils literal">python</tt> at the CMD.EXE prompt</p>
<p>I could have gone to the Microsoft App Store and install it myself, but I
actually went to <a class="reference external" href="https://python.org">https://python.org</a> and got an installer from there.</p>
<p>Then</p>
<pre class="literal-block">
C:\Users\Tibs&gt;mkdir temp
C:\Users\Tibs&gt;cd temp
</pre>
<p>Python is Python 3;</p>
<img alt="images/ScreenshotWindows0a.png" src="images/ScreenshotWindows0a.png" style="width: 1209.0px; height: 81.0px;" />
<p>(on Windows, exit the Python prompt by pressing the <tt class="docutils literal"><span class="pre">CTRL-Z</span></tt> key and then
pressing the Return key, or by typing <tt class="docutils literal">exit()</tt> and then pressing the Return
key).</p>
<pre class="literal-block">
C:\Users\Tibs\temp&gt;python3 -m venv venv
</pre>
<p>or the same command line as a picture:</p>
<img alt="images/ScreenshotWindows0b.png" src="images/ScreenshotWindows0b.png" style="width: 494.0px; height: 34.0px;" />
<p>The new <tt class="docutils literal">venv</tt> directory is much like that on unix, but there is a
<tt class="docutils literal">Scripts</tt> directory, instead of the <tt class="docutils literal">bin</tt> directory:</p>
<img alt="images/ScreenshotWindows1.png" src="images/ScreenshotWindows1.png" style="width: 636.0px; height: 324.0px;" />
<p>And as on unix we have a <tt class="docutils literal">pyvenv.cfg</tt> which describes the virtual
environment:</p>
<img alt="images/ScreenshotWindows2.png" src="images/ScreenshotWindows2.png" style="width: 1345.0px; height: 96.0px;" />
<p>In the <tt class="docutils literal">Scripts</tt> directory, we have:</p>
<img alt="images/ScreenshotWindows3.png" src="images/ScreenshotWindows3.png" style="width: 734.0px; height: 474.0px;" />
<p>When we <tt class="docutils literal">activate</tt> (no need for the <tt class="docutils literal">source</tt>), we get the prompt altered,
just as on unix:</p>
<img alt="images/ScreenshotWindows4.png" src="images/ScreenshotWindows4.png" style="width: 557.0px; height: 67.0px;" />
<p>We don't yet have <tt class="docutils literal">requests</tt> installed for this Python:</p>
<img alt="images/ScreenshotWindows5.png" src="images/ScreenshotWindows5.png" style="width: 596.0px; height: 179.0px;" />
<p>but if we do:</p>
<pre class="literal-block">
&gt;pip install requests
</pre>
<p>we get the normal output, and it also (as for unix) tells us we might want to
upgrade pip.</p>
<p>Now <tt class="docutils literal">requests</tt> is available:</p>
<img alt="images/ScreenshotWindows6.png" src="images/ScreenshotWindows6.png" style="width: 891.0px; height: 116.0px;" />
<p>and the <tt class="docutils literal"><span class="pre">site-packages</span></tt> library in the <tt class="docutils literal">venv</tt> has gone from:</p>
<img alt="images/ScreenshotWindows7.png" src="images/ScreenshotWindows7.png" style="width: 767.0px; height: 348.0px;" />
<p>to:</p>
<img alt="images/ScreenshotWindows8.png" src="images/ScreenshotWindows8.png" style="width: 822.0px; height: 604.0px;" />
<div class="section" id="installing-poetry">
<h2><a class="toc-backref" href="#id64">Installing poetry</a></h2>
<p>The <a class="reference external" href="https://python-poetry.org/">poetry</a> documentation tells you how to install poetry on Windows if you're
using the Windows bash shell, or if you're using Powershell, but doesn't
actually say what to do if you're using CMD.EXE.</p>
<p>As it turns out, the instructions for unix shells / the Windows bash shell:</p>
<pre class="literal-block">
curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python
</pre>
<p>also work in CMD.EXE - although you may then need to add the poetry binary
directory to your path - for instance, in my case
<tt class="docutils literal"><span class="pre">C:\Users\Tibs\.poetry\bin\</span></tt>.</p>
</div>
</div>
<div class="section" id="interesting-links">
<h1><a class="toc-backref" href="#id65">Interesting Links</a></h1>
<p><a class="reference external" href="https://www.pluralsight.com/tech-blog/managing-python-environments/">https://www.pluralsight.com/tech-blog/managing-python-environments/</a> looks like
a really good resource.</p>
<p><a class="reference external" href="https://interrupt.memfault.com/blog/conda-developer-environments">https://interrupt.memfault.com/blog/conda-developer-environments</a> - using conda</p>
<p><a class="reference external" href="https://www.b-list.org/weblog/2020/jan/05/packaging/">https://www.b-list.org/weblog/2020/jan/05/packaging/</a> - A Python Packaging
Carol &quot;Quite often, I see people being wrong on the internet about Python
packaging. But the way in which they’re wrong is subtle, and often passes
unnoticed. The issue with much of the discussion is in conflating multiple
different things under the term “packaging”, and failing to be clear exactly
which of them is being discussed or criticized. In the spirit of Dickens, I’d
like to break up the concept of “packaging” into at least three different
topics, each associated with a specific use case, and then talk a bit about
each of them&quot;</p>
<p>Official documentation:</p>
<ul class="simple">
<li><a class="reference external" href="https://packaging.python.org/tutorials/installing-packages/#creating-virtual-environments">Creating Virtual Environments</a> in the <a class="reference external" href="https://packaging.python.org/tutorials/installing-packages">Python Packaging User Guide</a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/venv.html">venv - Creation of virtual environments</a> in the Python library documentation</li>
<li><a class="reference external" href="https://docs.python.org/3/tutorial/venv.html">Virtual Environments and Packages</a> in the Python tutorial</li>
</ul>
<p>Other interesting pages:</p>
<ul class="simple">
<li><a class="reference external" href="https://realpython.com/effective-python-environment/">An Effective Python Environment: Making Yourself at Home</a>, at <a class="reference external" href="https://realpython.com">Real Python</a></li>
<li><a class="reference external" href="https://howchoo.com/g/nwewzjmzmjc/a-guide-to-python-virtual-environments-with-virtualenvwrapper">A Guide to Python Virtual Environments with virtualenvwrapper</a></li>
<li><a class="reference external" href="https://www.techcoil.com/blog/how-to-create-a-python-3-virtual-environment-in-windows-10/">How to create a Python 3 virtual environment in Windows 10</a></li>
<li><a class="reference external" href="https://python-guide-ru.readthedocs.io/en/latest/dev/virtualenvs.html">Virtual Environments</a> at <a class="reference external" href="https://python-guide-ru.readthedocs.io/">The Hitchhiker's Guide to Python</a>, which shows
how to use <a class="reference external" href="https://virtualenv.pypa.io">virtualenv</a> and <a class="reference external" href="https://virtualenvwrapper.readthedocs.io">virtualenvwrapper</a></li>
</ul>
<p>I don't talk about using <tt class="docutils literal">conda</tt> here, but it's an alternative to the normal
Python virtual environment mechanisms that was introduced by the <a class="reference external" href="https://anaconda.org/">Anaconda</a>
project, which is much used in scientific Python.</p>
<ul class="simple">
<li><a class="reference external" href="https://towardsdatascience.com/getting-started-with-python-environments-using-conda-32e9f2779307">Getting started with Python environments (using Conda)</a></li>
</ul>
<p>The series <a class="reference external" href="https://www.pythoncheatsheet.org/blog/python-projects-with-poetry-and-vscode-part-1/">Python projects with Poetry and VSCode</a> (that link points to the
first article) explains how to start a new project with poetry, add its
virtual environment to VS Code, write some code, and finally publish it to
<a class="reference external" href="https://pypi.org/">PyPi</a>.</p>
<p>The <tt class="docutils literal">pyproject.toml</tt> file that poetry uses is actually part of the future of
Python project specification. See <a class="reference external" href="https://www.python.org/dev/peps/pep-0518/">PEP-518</a> (Specifying Minimum Build System
Requirements for Python Projects) and also <a class="reference external" href="https://www.python.org/dev/peps/pep-0517/">PEP-517</a> (A build-system
independent format for source trees).</p>
</div>
</div>
</body>
</html>
